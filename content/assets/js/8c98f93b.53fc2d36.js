"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[55815],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),i=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=i(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=i(a),m=r,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||l;return a?n.createElement(k,o(o({ref:t},u),{},{components:a})):n.createElement(k,o({ref:t},u))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=m;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p[c]="string"==typeof e?e:r,o[1]=p;for(var i=2;i<l;i++)o[i]=a[i];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},23532:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>p,toc:()=>i});var n=a(87462),r=(a(67294),a(3905));const l={id:"concepts-broker-load-balancing-quick-start",title:"Quick start",sidebar_label:"Quick start"},o=void 0,p={unversionedId:"concepts-broker-load-balancing-quick-start",id:"concepts-broker-load-balancing-quick-start",title:"Quick start",description:"Broker load balancing helps you distribute messages evenly among brokers and ensure efficient utilization of resources across Pulsar clusters.",source:"@site/docs/concepts-broker-load-balancing-quick-start.md",sourceDirName:".",slug:"/concepts-broker-load-balancing-quick-start",permalink:"/docs/next/concepts-broker-load-balancing-quick-start",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/docs/concepts-broker-load-balancing-quick-start.md",tags:[],version:"current",frontMatter:{id:"concepts-broker-load-balancing-quick-start",title:"Quick start",sidebar_label:"Quick start"},sidebar:"docsSidebar",previous:{title:"Types",permalink:"/docs/next/concepts-broker-load-balancing-types"},next:{title:"Migration",permalink:"/docs/next/concepts-broker-load-balancing-migration"}},s={},i=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure broker load balancer to run automatically",id:"configure-broker-load-balancer-to-run-automatically",level:2},{value:"Step 1. Start ZooKeeper, bookie, and broker",id:"step-1-start-zookeeper-bookie-and-broker",level:3},{value:"Step 2. Start a Pulsar cluster",id:"step-2-start-a-pulsar-cluster",level:3},{value:"Step 3. Check the status of broker and load balancer (Optional)",id:"step-3-check-the-status-of-broker-and-load-balancer-optional",level:3},{value:"Step 4. Create a topic",id:"step-4-create-a-topic",level:3},{value:"Step 5. Split bundles",id:"step-5-split-bundles",level:3},{value:"Step 6. Unload bundles",id:"step-6-unload-bundles",level:3},{value:"Configure broker load balancer to run manually",id:"configure-broker-load-balancer-to-run-manually",level:2},{value:"Step 1. Start ZooKeeper, bookie, and broker",id:"step-1-start-zookeeper-bookie-and-broker-1",level:3},{value:"Step 2. Start a Pulsar cluster",id:"step-2-start-a-pulsar-cluster-1",level:3},{value:"Step 3. Create a topic",id:"step-3-create-a-topic",level:3},{value:"Step 4. Split bundles",id:"step-4-split-bundles",level:3},{value:"Step 5. Check ownerships between topics and brokers",id:"step-5-check-ownerships-between-topics-and-brokers",level:3},{value:"Step 6. Unload bundles",id:"step-6-unload-bundles-1",level:3},{value:"Related topics",id:"related-topics",level:2}],u={toc:i},c="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-overview"},"Broker load balancing")," helps you distribute messages evenly among brokers and ensure efficient utilization of resources across Pulsar clusters."),(0,r.kt)("p",null,"This tutorial guides you through the steps for getting started with broker load balancing using Pulsar 3.0.0 in Docker."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"/docs/next/getting-started-standalone"},"Install Pulsar"),": "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you want to run the modular load balancer, use Pulsar 1.7.0 or later versions. ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you want to run the extensible load balancer, use Pulsar 3.0.0 or later versions.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Install Docker and allocate at least 8 GB of memory."))),(0,r.kt)("h2",{id:"configure-broker-load-balancer-to-run-automatically"},"Configure broker load balancer to run automatically"),(0,r.kt)("p",null,"If you want to use broker load balancing automatically, follow the steps below."),(0,r.kt)("h3",{id:"step-1-start-zookeeper-bookie-and-broker"},"Step 1. Start ZooKeeper, bookie, and broker"),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," file and copy the following code to that file. "),(0,r.kt)("p",null,"This example starts a ZooKeeper server, a bookie, and 2 brokers, sets the load balancer type to extensible, sets the unloading strategy to ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"TransferShedder"),", and enables debug mode."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'3\'\nnetworks:\n  pulsar:\n    driver: bridge\nservices:\n  # Start ZooKeeper\n  zookeeper:\n    image: apachepulsar/pulsar:3.0.1\n    container_name: zookeeper\n    restart: on-failure\n    networks:\n      - pulsar\n    volumes:\n      - ./data/zookeeper:/pulsar/data/zookeeper\n    environment:\n      - metadataStoreUrl=zk:zookeeper:2181\n      - PULSAR_MEM=-Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m\n    command: >\n      bash -c "bin/apply-config-from-env.py conf/zookeeper.conf && \\\n             bin/generate-zookeeper-config.sh conf/zookeeper.conf && \\\n             exec bin/pulsar zookeeper"\n    healthcheck:\n      test: ["CMD", "bin/pulsar-zookeeper-ruok.sh"]\n      interval: 10s\n      timeout: 5s\n      retries: 30\n\n  # Initialize cluster metadata\n  pulsar-init:\n    container_name: pulsar-init\n    hostname: pulsar-init\n    image: apachepulsar/pulsar:3.0.1\n    networks:\n      - pulsar\n    command: >\n      bin/pulsar initialize-cluster-metadata \\\n               --cluster cluster-a \\\n               --zookeeper zookeeper:2181 \\\n               --configuration-store zookeeper:2181 \\\n               --web-service-url http://broker:8080 \\\n               --broker-service-url pulsar://broker:6650\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n\n  # Start bookie\n  bookie:\n    image: apachepulsar/pulsar:3.0.1\n    container_name: bookie\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - clusterName=cluster-a\n      - zkServers=zookeeper:2181\n      - metadataServiceUri=metadata-store:zk:zookeeper:2181\n      - advertisedAddress=bookie\n      - BOOKIE_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=256m\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      pulsar-init:\n        condition: service_completed_successfully\n    volumes:\n      - ./data/bookkeeper:/pulsar/data/bookkeeper\n    command: bash -c "bin/apply-config-from-env.py conf/bookkeeper.conf && exec bin/pulsar bookie"\n\n  # Start broker 1\n  broker-1:\n    image: apachepulsar/pulsar:3.0.1\n    container_name: broker-1\n    hostname: broker-1\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - metadataStoreUrl=zk:zookeeper:2181\n      - zookeeperServers=zookeeper:2181\n      - clusterName=cluster-a\n      - managedLedgerDefaultEnsembleSize=1\n      - managedLedgerDefaultWriteQuorum=1\n      - managedLedgerDefaultAckQuorum=1\n      - advertisedAddress=broker-1\n      - internalListenerName=internal\n      - advertisedListeners=internal:pulsar://broker-1:6650\n      - brokerServicePort=6650\n      - webServicePort=8080\n      - PULSAR_MEM=-Xms128m -Xmx2096m -XX:MaxDirectMemorySize=256m\n      # Load Manager. Here uses the extensible load balancer, sets the unloading strategy to TransferShedder, and enables debug mode.\n      - loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl\n      - loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.extensions.scheduler.TransferShedder\n      - PULSAR_PREFIX_loadBalancerDebugModeEnabled=true\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      bookie:\n        condition: service_started\n    command: bash -c "bin/apply-config-from-env.py conf/broker.conf && exec bin/pulsar broker"\n\n  # Start broker 2\n  broker-2:\n    image: apachepulsar/pulsar:3.0.1\n    container_name: broker-2\n    hostname: broker-2\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - metadataStoreUrl=zk:zookeeper:2181\n      - zookeeperServers=zookeeper:2181\n      - clusterName=cluster-a\n      - managedLedgerDefaultEnsembleSize=1\n      - managedLedgerDefaultWriteQuorum=1\n      - managedLedgerDefaultAckQuorum=1\n      - advertisedAddress=broker-2\n      - internalListenerName=internal\n      - advertisedListeners=internal:pulsar://broker-2:6650\n      - webServicePort=8080\n      - brokerServicePort=6650\n      - PULSAR_MEM=-Xms128m -Xmx2096m -XX:MaxDirectMemorySize=256m\n      # Load Manager. Here uses the extensible load balancer, sets the unloading strategy to TransferShedder, and enables debug mode.\n      - loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl\n      - loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.extensions.scheduler.TransferShedder\n      - PULSAR_PREFIX_loadBalancerDebugModeEnabled=true\n\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      bookie:\n        condition: service_started\n    command: bash -c "bin/apply-config-from-env.py conf/broker.conf && exec bin/pulsar broker"\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you use other ways instead of using a yaml file as above, you can choose a broker load balancer type or set an unloading strategy by updating ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1309C7-L1309C7"},"loadManagerClassName")," or ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1324"},"loadBalancerLoadSheddingStrategy")," in the broker.conf file "),(0,r.kt)("p",{parentName:"admonition"},"It is not recommended to use the ",(0,r.kt)("a",{parentName:"p",href:"(pathname:///reference/#/next/pulsar-admin/brokers?id=update-dynamic-config)"},"pulsar-admin update-dynamic-config")," because it will throw an exception if the Pulsar version and the unloading strategy are incompatible. ")),(0,r.kt)("h3",{id:"step-2-start-a-pulsar-cluster"},"Step 2. Start a Pulsar cluster"),(0,r.kt)("p",null,"2.1 Open a tab in the terminal (i.e., terminal tab 1) and execute the following commands."),(0,r.kt)("p",null,"2.2 Start a Pulsar cluster."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker compose up -d\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that the broker 1 and broker 2 are running."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[+] Running 12/12\n \u2714 broker-1 Pulled                                                                                                                                                   242.5s\n \u2714 zookeeper Pulled                                                                                                                                                  242.5s\n \u2714 broker-2 Pulled                                                                                                                                                   242.5s\n \u2714 pulsar-init Pulled                                                                                                                                                242.5s\n \u2714 bookie 7 layers [\u28ff\u28ff\u28ff\u28ff\u28ff\u28ff\u28ff]      0B/0B      Pulled                                                                                                                  242.5s\n   \u2714 3153aa388d02 Already exists                                                                                                                                       0.0s\n   \u2714 5d127458ab3b Pull complete                                                                                                                                       83.3s\n   \u2714 1f99067df50d Pull complete                                                                                                                                      160.0s\n   \u2714 85fd7b6fa5dc Pull complete                                                                                                                                      160.0s\n   \u2714 ff6d7ec52b64 Pull complete                                                                                                                                      160.0s\n   \u2714 b53efccabef0 Pull complete                                                                                                                                      238.5s\n   \u2714 6425449412d7 Pull complete                                                                                                                                      238.8s\n[+] Running 11/11\n \u2714 Network docker_pulsar                                                                                                                                      Created  0.1s\n \u2714 Container zookeeper                                                                                                                                        Healthy 25.1s\n ! zookeeper The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested            0.0s\n \u2714 Container pulsar-init                                                                                                                                      Exited  24.0s\n ! pulsar-init The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested          0.0s\n \u2714 Container bookie                                                                                                                                           Started 24.2s\n ! bookie The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested               0.0s\n \u2714 Container broker-1                                                                                                                                         Started 25.0s\n \u2714 Container broker-2                                                                                                                                         Started 25.0s\n ! broker-1 The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested             0.0s\n ! broker-2 The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested             0.0s\n")),(0,r.kt)("h3",{id:"step-3-check-the-status-of-broker-and-load-balancer-optional"},"Step 3. Check the status of broker and load balancer (Optional)"),(0,r.kt)("p",null,"In terminal tab 1, execute the following commands."),(0,r.kt)("p",null,"3.1 Enter the container of broker 1."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it broker-1 bash\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"3.2 Display the list of brokers in your cluster."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin brokers list my-cluster\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows there are 2 brokers."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"broker-2:8081\nbroker-1:8080\n")),(0,r.kt)("p",null,"3.3 Verify the load balancer type."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin brokers get-runtime-config | grep loadManagerClassName\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows the load balancer type is extensible."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"loadManagerClassName org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl\n")),(0,r.kt)("h3",{id:"step-4-create-a-topic"},"Step 4. Create a topic"),(0,r.kt)("p",null,"In terminal tab 1, execute the following commands."),(0,r.kt)("p",null,"4.1 Enter the container of broker 1."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it broker-1 bash\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"4.2 Create a partitioned topic named my-topic-1 with 2000 partitions under my-tenant-1/my-namespace-1."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This example simplifies the task by only specifying 1 bundle. For details on how to set a reasonable number of bundles, see ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L281C7-L281C7"},"defaultNumberOfNamespaceBundles"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin tenants create my-tenant-1 \nbin/pulsar-admin namespaces create my-tenant-1/my-namespace-1 --bundles 1 bin/pulsar-admin topics create-partitioned-topic persistent://my-tenant-1/my-namespace-1/my-topic-1 -p 2000\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"4.3 Produce messages to the topic using the ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools"},"pulsar-perf tool"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-perf produce persistent://my-tenant-1/my-namespace-1/my-topic-1 -r 400 -bm 1 -mk random\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that messages have been produced."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"2023-07-21T05:08:24,261+0000 [main] INFO org.apache.pulsar.testclient.PerformanceProducer - JVM args [-Dlog4j.configurationFile=log4j2.yaml, -Djava.net.preferIPv4Stack=true, --add-opens=java.base/sun.net=ALL-UNNAMED, --add-opens=java.base/java.lang=ALL-UNNAMED, -Dpulsar.allocator.exit_on_oom=true, -Dio.netty.recycler.maxCapacityPerThread=4096, -Dpulsar.log.appender=Console, -Dpulsar.log.level=info, -Dpulsar.log.root.level=info, -Dpulsar.log.immediateFlush=false, -Dpulsar.log.dir=/pulsar/logs, -Dpulsar.log.file=pulsar-perftest.log] 2023-07-21T05:08:24,305+0000 [main] INFO org.apache.pulsar.testclient.PerformanceProducer - Netty max memory (PlatformDependent.maxDirectMemory()) 1 GB 2023-07-21T05:08:24,305+0000 [main] INFO org.apache.pulsar.testclient.PerformanceProducer - JVM max heap memory (Runtime.getRuntime().maxMemory()) 1 GB 2023-07-21T05:08:24,409+0000 [main] INFO org.apache.pulsar.testclient.PerformanceProducer - Starting Pulsar perf producer with config: { \n...\n")),(0,r.kt)("h3",{id:"step-5-split-bundles"},"Step 5. Split bundles"),(0,r.kt)("p",null,"5.1 Open another tab in the terminal (i.e., terminal tab 2) and execute the following commands."),(0,r.kt)("p",null,"5.2 Enter the container of broker 2."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it broker-2 bash\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"5.3 Verify whether the bundles are split after 5 minutes. It takes a little time for Pulsar to split bundles."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The automatic bundle splitting is ",(0,r.kt)("strong",{parentName:"p"},"enabled by default"),". To disable it, update the following configurations to false in the broker.conf file. "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1278"},"loadBalancerAutoBundleSplitEnabled"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1281C4-L1281C4"},"loadBalancerAutoUnloadSplitBundlesEnabled")," ")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The default bundle splitting algorithm is ",(0,r.kt)("inlineCode",{parentName:"p"},"range_equally_divide"),". You can change it to other ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-splitting-algorithms"},"bundle splitting algorithms")," by updating ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1321C18-L1321C18"},"defaultNamespaceBundleSplitAlgorithm")," in the broker.conf file. ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For bundle splitting thresholds, you can set more configurations in the broker.conf file. Any existing bundle that exceeds any of the thresholds is a candidate to be split. ")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin namespaces bundles my-tenant/my-namespace\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that the bundle has been split into 3 ranges."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "boundaries" : [ "0x00000000", "0x3fffffff", "0x7fffffff", "0xffffffff" ],\n  "numBundles" : 3\n}\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The number of bundles may vary depending on the time. For example, if you wait longer than 5 minutes, the number of bundles may increase. If the number of bundles is equal to or greater than 2, it means that the bundle has been split.")),(0,r.kt)("h3",{id:"step-6-unload-bundles"},"Step 6. Unload bundles"),(0,r.kt)("p",null,"You can verify if a bundle has been unloaded using the metric ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-metrics#load-balancing"},"pulsar_lb_unload_bundle_total"),". This method is only supported in the automatic way."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The automatic bundle unloading is ",(0,r.kt)("strong",{parentName:"p"},"enabled by default"),". To disable it, update ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1259C14-L1259C14"},"loadBalancerSheddingEnabled")," to false in the broker.conf file. ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("strong",{parentName:"p"},"default")," bundle unloading strategy is TransferShedder (for the extensible broker load balancer) or ThresholdShedder (for the modular broker load balancer). You can change it to other ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategies")," by updating ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1324C52-L1324C52"},"loadBalancerLoadSheddingStrategy")," in the broker.conf file. ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For bundle unloading conditions, you can set more configurations in the broker.conf file. ")))),(0,r.kt)("h2",{id:"configure-broker-load-balancer-to-run-manually"},"Configure broker load balancer to run manually"),(0,r.kt)("p",null,"If you want to use broker load balancing manually, follow the steps below."),(0,r.kt)("h3",{id:"step-1-start-zookeeper-bookie-and-broker-1"},"Step 1. Start ZooKeeper, bookie, and broker"),(0,r.kt)("p",null,"This is the same as ",(0,r.kt)("a",{parentName:"p",href:"#step-1-start-zookeeper-bookie-and-broker"},"Step 1. Start ZooKeeper, bookie, and broker")," in the automatic method."),(0,r.kt)("h3",{id:"step-2-start-a-pulsar-cluster-1"},"Step 2. Start a Pulsar cluster"),(0,r.kt)("p",null,"This is the same as ",(0,r.kt)("a",{parentName:"p",href:"#step-2-start-a-pulsar-cluster"},"Step 2. Start a Pulsar cluster")," in the automatic method."),(0,r.kt)("h3",{id:"step-3-create-a-topic"},"Step 3. Create a topic"),(0,r.kt)("p",null,"3.1 Enter the container of broker 1."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker exec -it broker-1 bash\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"3.2 Create a partitioned topic named topic-manual with 20 partitions under public/default."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin topics create-partitioned-topic persistent://public/default/topic-manual -p 20\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("h3",{id:"step-4-split-bundles"},"Step 4. Split bundles"),(0,r.kt)("p",null,"4.1 List all bundles."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin namespaces bundles public/default\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that the number of bundles is 17."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "boundaries" : [ "0x00000000", "0x08000000", "0x10000000", "0x20000000", "0x30000000", "0x40000000", "0x50000000", "0x60000000", "0x70000000", "0x80000000", "0x90000000", "0xa0000000", "0xb0000000", "0xc0000000", "0xd0000000", "0xe0000000", "0xf0000000", "0xffffffff" ],\n  "numBundles" : 17\n}\n')),(0,r.kt)("p",null,"4.2 Specify the range ",(0,r.kt)("inlineCode",{parentName:"p"},"public/default/0x00000000_0x8000000")," to be split."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin namespaces split-bundle --bundle 0x00000000_0x10000000 public/default\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("strong",{parentName:"p"},"default")," bundle splitting algorithm is ",(0,r.kt)("inlineCode",{parentName:"p"},"range_equally_divide"),". You can change it to other ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-splitting-algorithms"},"bundle splitting algorithms")," using one of the following methods:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Update ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1321C18-L1321C18"},"defaultNamespaceBundleSplitAlgorithm")," in the broker.conf file ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Use ",(0,r.kt)("a",{parentName:"p",href:"pathname:///reference/#/next/pulsar-admin/namespaces?id=split-bundle"},"pulsar-admin namespaces split-bundle"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For bundle splitting thresholds, you can set more configurations in the broker.conf file. Any existing bundle that exceeds any of the thresholds is a candidate to be split.")))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Manual settings will override automatic configurations. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"range_equally_divide")," is the ",(0,r.kt)("strong",{parentName:"p"},"default")," bundling splitting algorithm, but if you manually set the bundling splitting algorithm to ",(0,r.kt)("inlineCode",{parentName:"p"},"topic_count_equally_divide"),", then ",(0,r.kt)("inlineCode",{parentName:"p"},"topic_count_equally_divide")," is used.")),(0,r.kt)("p",null,"4.3 Verify if the bundle has been split."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin namespaces bundles public/default\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that the number of bundles is 18 (increased from 17), which means the bundle has been split."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'{\n  "boundaries" : [ "0x00000000", "0x04000000", "0x08000000", "0x10000000", "0x20000000", "0x30000000", "0x40000000", "0x50000000", "0x60000000", "0x70000000", "0x80000000", "0x90000000", "0xa0000000", "0xb0000000", "0xc0000000", "0xd0000000", "0xe0000000", "0xf0000000", "0xffffffff" ],\n  "numBundles" : 18\n}\n')),(0,r.kt)("h3",{id:"step-5-check-ownerships-between-topics-and-brokers"},"Step 5. Check ownerships between topics and brokers"),(0,r.kt)("p",null,"Check the ownerships between topics (partitions) and brokers. This step is preparing to verify the result for ",(0,r.kt)("a",{parentName:"p",href:"#step-6-unload-bundles"},"Step 6. Unload bundles"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin topics partitioned-lookup persistent://public/default/topic-manual\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"The output shows that more partitions belong to the broker 1."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"persistent://public/default/topic-manual-2-partition-0    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-1    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-2    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-3    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-4    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-5    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-6    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-7    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-8    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-9    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-10    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-11    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-12    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-13    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-14    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-15    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-16    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-17    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-18    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-19    pulsar://broker-1:6650\n")),(0,r.kt)("h3",{id:"step-6-unload-bundles-1"},"Step 6. Unload bundles"),(0,r.kt)("p",null,"6.1 Unload the bundle range ",(0,r.kt)("inlineCode",{parentName:"p"},"public/default/0x10000000_0x20000000")," and allocate bundles to broker 1."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin namespaces unload public/default -b 0x10000000_0x20000000 -d http://broker-1:8080\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"If there is no output, the operation is successful."),(0,r.kt)("p",null,"6.2 Verify if this range has been unloaded by checking the ownerships between topics (partitions) and brokers. "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Input")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin topics partitioned-lookup persistent://public/default/topic-manual\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("p",null,"Compared to the result of ",(0,r.kt)("a",{parentName:"p",href:"#step-5-check-ownerships-between-topics-and-brokers"},"Step 5. Check ownerships between topics and brokers"),", the output shows that more partitions belong to the broker 2."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"persistent://public/default/topic-manual-2-partition-0    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-1    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-2    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-3    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-4    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-5    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-6    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-7    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-8    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-9    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-10    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-11    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-12    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-13    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-14    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-15    pulsar://broker-2:6650\npersistent://public/default/topic-manual-2-partition-16    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-17    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-18    pulsar://broker-1:6650\npersistent://public/default/topic-manual-2-partition-19    pulsar://broker-2:6650\n")),(0,r.kt)("h2",{id:"related-topics"},"Related topics"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To get a comprehensive understanding and discover the key insights, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-overview"},"Broker load balancing | Overview"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To discover different usage scenarios, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-use-cases"},"Broker load balancing | Use cases"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To explore functionalities, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-features"},"Broker load balancing | Features"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To understand advantages, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-benefits"},"Broker load balancing | Benefits"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To learn essential fundamentals, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts"},"Broker load balancing | Concepts"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To review various versions of broker load balancers, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-types"},"Broker load balancing | Types"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To migrate one broker load balancer type to another, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-migration"},"Broker load balancing | Migration"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To understand design ideas and implementation details of the extensible load balancer, see ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/issues/16691"},"PIP-192: New Pulsar Broker Load Balancer"),"."))))}d.isMDXComponent=!0}}]);