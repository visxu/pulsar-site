"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[14325],{15680:(e,t,a)=>{a.d(t,{xA:()=>s,yg:()=>c});var n=a(96540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},s=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,s=g(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,c=d["".concat(o,".").concat(m)]||d[m]||y[m]||l;return a?n.createElement(c,i(i({ref:t},s),{},{components:a})):n.createElement(c,i({ref:t},s))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=m;var g={};for(var o in t)hasOwnProperty.call(t,o)&&(g[o]=t[o]);g.originalType=e,g[d]="string"==typeof e?e:r,i[1]=g;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},36795:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>y,frontMatter:()=>l,metadata:()=>g,toc:()=>p});var n=a(58168),r=(a(96540),a(15680));const l={id:"client-libraries-websocket",title:"Pulsar WebSocket API",sidebar_label:"WebSocket",description:"Learn how to use Pulsar WebSocket API to interact with Pulsar using languages that do not have an official client library."},i=void 0,g={unversionedId:"client-libraries-websocket",id:"version-4.0.x/client-libraries-websocket",title:"Pulsar WebSocket API",description:"Learn how to use Pulsar WebSocket API to interact with Pulsar using languages that do not have an official client library.",source:"@site/versioned_docs/version-4.0.x/client-libraries-websocket.md",sourceDirName:".",slug:"/client-libraries-websocket",permalink:"/docs/4.0.x/client-libraries-websocket",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-4.0.x/client-libraries-websocket.md",tags:[],version:"4.0.x",frontMatter:{id:"client-libraries-websocket",title:"Pulsar WebSocket API",sidebar_label:"WebSocket",description:"Learn how to use Pulsar WebSocket API to interact with Pulsar using languages that do not have an official client library."},sidebar:"docsSidebar",previous:{title:"Use",permalink:"/docs/4.0.x/client-libraries-dotnet-use"},next:{title:"REST",permalink:"/docs/4.0.x/client-libraries-rest"}},o={},p=[{value:"Run the WebSocket service",id:"run-the-websocket-service",level:2},{value:"Embedded with a Pulsar broker",id:"embedded-with-a-pulsar-broker",level:3},{value:"As a separate component",id:"as-a-separate-component",level:3},{value:"Security settings",id:"security-settings",level:3},{value:"Start the broker",id:"start-the-broker",level:3},{value:"Release notes",id:"release-notes",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Browser javascript WebSocket client",id:"browser-javascript-websocket-client",level:4},{value:"Producer endpoint",id:"producer-endpoint",level:3},{value:"Query param",id:"query-param",level:5},{value:"Publish a message",id:"publish-a-message",level:4},{value:"Example success response",id:"example-success-response",level:5},{value:"Example failure response",id:"example-failure-response",level:5},{value:"Consumer endpoint",id:"consumer-endpoint",level:3},{value:"Query param",id:"query-param-1",level:5},{value:"Receive messages",id:"receive-messages",level:5},{value:"Acknowledge the message",id:"acknowledge-the-message",level:4},{value:"Negatively acknowledge messages",id:"negatively-acknowledge-messages",level:4},{value:"Flow control",id:"flow-control",level:4},{value:"Push Mode",id:"push-mode",level:5},{value:"Pull Mode",id:"pull-mode",level:5},{value:"Check if reach the end of topic",id:"check-if-reach-the-end-of-topic",level:4},{value:"Reader endpoint",id:"reader-endpoint",level:3},{value:"Query param",id:"query-param-2",level:5},{value:"Receiving messages",id:"receiving-messages",level:5},{value:"Acknowledging the message",id:"acknowledging-the-message",level:4},{value:"Check if reach the end of topic",id:"check-if-reach-the-end-of-topic-1",level:4},{value:"Error codes",id:"error-codes",level:3},{value:"Client examples",id:"client-examples",level:2},{value:"Python",id:"python",level:3},{value:"Python producer",id:"python-producer",level:4},{value:"Python consumer",id:"python-consumer",level:4},{value:"Python reader",id:"python-reader",level:4},{value:"Node.js",id:"nodejs",level:3},{value:"Node.js producer",id:"nodejs-producer",level:4},{value:"Node.js consumer",id:"nodejs-consumer",level:4},{value:"NodeJS reader",id:"nodejs-reader",level:4}],s={toc:p},d="wrapper";function y(e){let{components:t,...a}=e;return(0,r.yg)(d,(0,n.A)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Pulsar ",(0,r.yg)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"},"WebSocket")," API provides a simple way to interact with Pulsar using languages that do not have an official ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/client-libraries"},"client library"),". You can use Pulsar WebSocket API with any WebSocket client library. See ",(0,r.yg)("a",{parentName:"p",href:"#client-examples"},"Python and Node.js examples")," for more details."),(0,r.yg)("p",null,"Through WebSocket, you can publish and consume messages and use features available on the ",(0,r.yg)("a",{parentName:"p",href:"/client-feature-matrix/"},"Client Feature Matrix")," page."),(0,r.yg)("h2",{id:"run-the-websocket-service"},"Run the WebSocket service"),(0,r.yg)("p",null,"The standalone variant of Pulsar that we recommend using for ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/getting-started-standalone"},"local development")," already has the WebSocket service enabled."),(0,r.yg)("p",null,"In non-standalone mode, there are two ways to deploy the WebSocket service:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"#embedded-with-a-pulsar-broker"},"embedded")," with a Pulsar broker"),(0,r.yg)("li",{parentName:"ul"},"as a ",(0,r.yg)("a",{parentName:"li",href:"#as-a-separate-component"},"separate component"))),(0,r.yg)("h3",{id:"embedded-with-a-pulsar-broker"},"Embedded with a Pulsar broker"),(0,r.yg)("p",null,"In this mode, the WebSocket service will run within the same HTTP service that's already running in the broker. To enable this mode, set the ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-configuration#broker-webSocketServiceEnabled"},(0,r.yg)("inlineCode",{parentName:"a"},"webSocketServiceEnabled"))," parameter in the ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-configuration#broker"},(0,r.yg)("inlineCode",{parentName:"a"},"conf/broker.conf"))," configuration file in your installation."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-properties"},"webSocketServiceEnabled=true\n")),(0,r.yg)("h3",{id:"as-a-separate-component"},"As a separate component"),(0,r.yg)("p",null,"In this mode, the WebSocket service will be run from a Pulsar ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-terminology#broker"},"broker")," as a separate service. Configuration for this mode is handled in the ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-configuration#websocket"},(0,r.yg)("inlineCode",{parentName:"a"},"conf/websocket.conf"))," configuration file. You'll need to set ",(0,r.yg)("em",{parentName:"p"},"at least")," the following parameters:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/4.0.x/reference-configuration#websocket"},(0,r.yg)("inlineCode",{parentName:"a"},"configurationMetadataStoreUrl"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/4.0.x/reference-configuration#websocket-webServicePort"},(0,r.yg)("inlineCode",{parentName:"a"},"webServicePort"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/docs/4.0.x/reference-configuration#websocket-clusterName"},(0,r.yg)("inlineCode",{parentName:"a"},"clusterName")))),(0,r.yg)("p",null,"Here's an example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-properties"},"configurationMetadataStoreUrl=zk1:2181,zk2:2181,zk3:2181\nwebServicePort=8080\nclusterName=my-cluster\n")),(0,r.yg)("h3",{id:"security-settings"},"Security settings"),(0,r.yg)("p",null,"To enable TLS encryption on WebSocket service, configure the following parameters in the ",(0,r.yg)("inlineCode",{parentName:"p"},"conf/broker.conf")," file."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-properties"},"tlsEnabled=true\ntlsAllowInsecureConnection=false\ntlsCertificateFilePath=/path/to/client-websocket.cert.pem\ntlsKeyFilePath=/path/to/client-websocket.key-pk8.pem\ntlsTrustCertsFilePath=/path/to/ca.cert.pem\n")),(0,r.yg)("p",null,"To enable encryption at rest on WebSocket service, add CryptoKeyReaderFactory factory class in classpath which will create CryptoKeyReader for WebSocket and that helps to load encryption keys for producer/consumer."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"cryptoKeyReaderFactoryClassName=org.apache.pulsar.MyCryptoKeyReaderFactoryClassImpl\n")),(0,r.yg)("h3",{id:"start-the-broker"},"Start the broker"),(0,r.yg)("p",null,"When the configuration is set, you can start the service using the ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-cli-tools"},(0,r.yg)("inlineCode",{parentName:"a"},"pulsar-daemon"))," tool:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"bin/pulsar-daemon start websocket\n")),(0,r.yg)("h2",{id:"release-notes"},"Release notes"),(0,r.yg)("p",null,"For the changelog of Pulsar WebSocket APIs, see ",(0,r.yg)("a",{parentName:"p",href:"/release-notes/client-ws"},"release notes"),"."),(0,r.yg)("h2",{id:"api-reference"},"API Reference"),(0,r.yg)("p",null,"Pulsar's WebSocket API offers three endpoints for ",(0,r.yg)("a",{parentName:"p",href:"#producer-endpoint"},"producing"),", ",(0,r.yg)("a",{parentName:"p",href:"#consumer-endpoint"},"consuming"),", and ",(0,r.yg)("a",{parentName:"p",href:"#reader-endpoint"},"reading")," messages."),(0,r.yg)("p",null,"All exchanges via the WebSocket API use JSON."),(0,r.yg)("h3",{id:"authentication"},"Authentication"),(0,r.yg)("h4",{id:"browser-javascript-websocket-client"},"Browser javascript WebSocket client"),(0,r.yg)("p",null,"Use the query param ",(0,r.yg)("inlineCode",{parentName:"p"},"token")," to transport the authentication token."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"ws://broker-service-url:8080/path?token=token\n")),(0,r.yg)("h3",{id:"producer-endpoint"},"Producer endpoint"),(0,r.yg)("p",null,"The producer endpoint requires you to specify a tenant, namespace, and topic in the URL:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"ws://broker-service-url:8080/ws/v2/producer/persistent/:tenant/:namespace/:topic\n")),(0,r.yg)("h5",{id:"query-param"},"Query param"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"sendTimeoutMillis")),(0,r.yg)("td",{parentName:"tr",align:"left"},"long"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Send timeout (default: 30 secs)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"batchingEnabled")),(0,r.yg)("td",{parentName:"tr",align:"left"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Enable batching of messages (default: false)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"batchingMaxMessages")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Maximum number of messages permitted in a batch (default: 1000)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"maxPendingMessages")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Set the max size of the internal-queue holding the messages (default: 1000)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"batchingMaxPublishDelay")),(0,r.yg)("td",{parentName:"tr",align:"left"},"long"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Time period within which the messages will be batched (default: 10ms)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageRoutingMode")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ",(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/index.html?org/apache/pulsar/client/api/ProducerConfiguration.MessageRoutingMode.html"},"routing mode")," for the partitioned producer: ",(0,r.yg)("inlineCode",{parentName:"td"},"SinglePartition"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"RoundRobinPartition"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"compressionType")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Compression ",(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/index.html?org/apache/pulsar/client/api/CompressionType.html"},"type"),": ",(0,r.yg)("inlineCode",{parentName:"td"},"LZ4"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"ZLIB"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"producerName")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Specify the name for the producer. Pulsar will enforce only one producer with same name can be publishing on a topic")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"initialSequenceId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"long"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Set the baseline for the sequence ids for messages published by the producer.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"hashingScheme")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/org/apache/pulsar/client/api/ProducerConfiguration.HashingScheme.html"},"Hashing function")," to use when publishing on a partitioned topic: ",(0,r.yg)("inlineCode",{parentName:"td"},"JavaStringHash"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"Murmur3_32Hash"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"token")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Authentication token, this is used for the browser javascript client")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"encryptionKeys")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Encryption key to encrypt published message only if encryption reader is configured using cryptoKeyReaderFactoryClassName config in websocket-configuration.")))),(0,r.yg)("h4",{id:"publish-a-message"},"Publish a message"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "payload": "SGVsbG8gV29ybGQ=",\n  "properties": {"key1": "value1", "key2": "value2"},\n  "context": "1"\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"payload")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Base-64 encoded payload")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"properties")),(0,r.yg)("td",{parentName:"tr",align:"left"},"key-value pairs"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined properties")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"context")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined request identifier")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"key")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"For partitioned topics, decides which partition to use")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"replicationClusters")),(0,r.yg)("td",{parentName:"tr",align:"left"},"array"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Restrict replication to this list of ",(0,r.yg)("a",{parentName:"td",href:"/docs/4.0.x/reference-terminology#cluster"},"clusters"),", specified by name")))),(0,r.yg)("h5",{id:"example-success-response"},"Example success response"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n   "result": "ok",\n   "messageId": "CAAQAw==",\n   "context": "1"\n }\n')),(0,r.yg)("h5",{id:"example-failure-response"},"Example failure response"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},' {\n   "result": "send-error:3",\n   "errorMsg": "Failed to de-serialize from JSON",\n   "context": "1"\n }\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"result")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"ok")," if successful or an error message if unsuccessful")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID assigned to the published message")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"context")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined request identifier")))),(0,r.yg)("h3",{id:"consumer-endpoint"},"Consumer endpoint"),(0,r.yg)("p",null,"The consumer endpoint requires you to specify a tenant, namespace, and topic, as well as a subscription, in the URL:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"ws://broker-service-url:8080/ws/v2/consumer/persistent/:tenant/:namespace/:topic/:subscription\n")),(0,r.yg)("h5",{id:"query-param-1"},"Query param"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"ackTimeoutMillis")),(0,r.yg)("td",{parentName:"tr",align:"left"},"long"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Set the timeout for unacked messages (default: 0)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionType")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/index.html?org/apache/pulsar/client/api/SubscriptionType.html"},"Subscription type"),": ",(0,r.yg)("inlineCode",{parentName:"td"},"Exclusive"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"Failover"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"Shared"),", ",(0,r.yg)("inlineCode",{parentName:"td"},"Key_Shared"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"receiverQueueSize")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Size of the consumer receive queue (default: 1000)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"consumerName")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Consumer name")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"priorityLevel")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Define a ",(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/org/apache/pulsar/client/api/ConsumerConfiguration.html#setPriorityLevel-int-"},"priority")," for the consumer")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"maxRedeliverCount")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Define a ",(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/org/apache/pulsar/client/api/ConsumerBuilder.html#deadLetterPolicy-org.apache.pulsar.client.api.DeadLetterPolicy-"},"maxRedeliverCount")," for the consumer (default: 0). Activates ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/pulsar/wiki/PIP-22%3A-Pulsar-Dead-Letter-Topic"},"Dead Letter Topic")," feature.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"deadLetterTopic")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Define a ",(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/4.0.x/org/apache/pulsar/client/api/ConsumerBuilder.html#deadLetterPolicy-org.apache.pulsar.client.api.DeadLetterPolicy-"},"deadLetterTopic")," for the consumer (default: {topic}-{subscription}-DLQ). Activates ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/apache/pulsar/wiki/PIP-22%3A-Pulsar-Dead-Letter-Topic"},"Dead Letter Topic")," feature.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"pullMode")),(0,r.yg)("td",{parentName:"tr",align:"left"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},'Enable pull mode (default: false). See "Flow Control" below.')),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"negativeAckRedeliveryDelay")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"When a message is negatively acknowledged, the delay time before the message is redelivered (in milliseconds). The default value is 60000.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"token")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Authentication token, this is used for the browser javascript client")))),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"These parameters (except ",(0,r.yg)("inlineCode",{parentName:"p"},"pullMode"),") apply to the internal consumers of the WebSocket service.\nSo messages will be subject to the redelivery settings as soon as they get into the receive queue,\neven if the client doesn't consume on the WebSocket.")),(0,r.yg)("h5",{id:"receive-messages"},"Receive messages"),(0,r.yg)("p",null,"Server will push messages on the WebSocket session:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "messageId": "CAMQADAA",\n  "payload": "hvXcJvHW7kOSrUn17P2q71RA5SdiXwZBqw==",\n  "properties": {},\n  "publishTime": "2021-10-29T16:01:38.967-07:00",\n  "redeliveryCount": 0,\n  "encryptionContext": {\n    "keys": {\n      "client-rsa.pem": {\n        "keyValue": "jEuwS+PeUzmCo7IfLNxqoj4h7txbLjCQjkwpaw5AWJfZ2xoIdMkOuWDkOsqgFmWwxiecakS6GOZHs94x3sxzKHQx9Oe1jpwBg2e7L4fd26pp+WmAiLm/ArZJo6JotTeFSvKO3u/yQtGTZojDDQxiqFOQ1ZbMdtMZA8DpSMuq+Zx7PqLo43UdW1+krjQfE5WD+y+qE3LJQfwyVDnXxoRtqWLpVsAROlN2LxaMbaftv5HckoejJoB4xpf/dPOUqhnRstwQHf6klKT5iNhjsY4usACt78uILT0pEPd14h8wEBidBz/vAlC/zVMEqiDVzgNS7dqEYS4iHbf7cnWVCn3Hxw==",\n        "metadata": {}\n      }\n    },\n    "param": "Tfu1PxVm6S9D3+Hk",\n    "compressionType": "NONE",\n    "uncompressedMessageSize": 0,\n    "batchSize": {\n      "empty": false,\n      "present": true\n    }\n  }\n}\n')),(0,r.yg)("p",null,"Below are the parameters in the WebSocket consumer response."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"General parameters"),(0,r.yg)("table",{parentName:"li"},(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"payload")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Base-64 encoded payload")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"publishTime")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Publish timestamp")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"redeliveryCount")),(0,r.yg)("td",{parentName:"tr",align:"left"},"number"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Number of times this message was already delivered")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"properties")),(0,r.yg)("td",{parentName:"tr",align:"left"},"key-value pairs"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined properties")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"key")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Original routing key set by producer")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"encryptionContext")),(0,r.yg)("td",{parentName:"tr",align:"left"},"EncryptionContext"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Encryption context that consumers can use to decrypt received messages")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"param")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Initialization vector for cipher (Base64 encoding)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"batchSize")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Number of entries in a message (if it is a batch message)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"uncompressedMessageSize")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message size before compression")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"compressionType")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Algorithm used to compress the message payload"))))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"encryptionContext")," related parameter"),(0,r.yg)("table",{parentName:"li"},(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"keys")),(0,r.yg)("td",{parentName:"tr",align:"left"},"key-EncryptionKey pairs"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Key in ",(0,r.yg)("inlineCode",{parentName:"td"},"key-EncryptionKey")," pairs is an encryption key name. Value in ",(0,r.yg)("inlineCode",{parentName:"td"},"key-EncryptionKey")," pairs is an encryption key object."))))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"encryptionKey")," related parameters"),(0,r.yg)("table",{parentName:"li"},(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"keyValue")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Encryption key (Base64 encoding)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"metadata")),(0,r.yg)("td",{parentName:"tr",align:"left"},"key-value pairs"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined metadata")))))),(0,r.yg)("h4",{id:"acknowledge-the-message"},"Acknowledge the message"),(0,r.yg)("p",null,"Consumer needs to acknowledge the successful processing of the message to\nhave the Pulsar broker delete it."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "messageId": "CAAQAw=="\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID of the processed message")))),(0,r.yg)("h4",{id:"negatively-acknowledge-messages"},"Negatively acknowledge messages"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "negativeAcknowledge",\n  "messageId": "CAAQAw=="\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID of the processed message")))),(0,r.yg)("h4",{id:"flow-control"},"Flow control"),(0,r.yg)("h5",{id:"push-mode"},"Push Mode"),(0,r.yg)("p",null,"By default (",(0,r.yg)("inlineCode",{parentName:"p"},"pullMode=false"),"), the consumer endpoint will use the ",(0,r.yg)("inlineCode",{parentName:"p"},"receiverQueueSize")," parameter both to size its internal receive queue and to limit the number of unacknowledged messages that are passed to the WebSocket client.\nIn this mode, if you don't send acknowledgments, the Pulsar WebSocket service will stop sending messages after reaching\n",(0,r.yg)("inlineCode",{parentName:"p"},"receiverQueueSize")," unacked messages sent to the WebSocket client."),(0,r.yg)("h5",{id:"pull-mode"},"Pull Mode"),(0,r.yg)("p",null,"If you set ",(0,r.yg)("inlineCode",{parentName:"p"},"pullMode")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"true"),", the WebSocket client will need to send ",(0,r.yg)("inlineCode",{parentName:"p"},"permit")," commands to permit the\nPulsar WebSocket service to send more messages."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "permit",\n  "permitMessages": 100\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"type")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Type of command. Must be ",(0,r.yg)("inlineCode",{parentName:"td"},"permit"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"permitMessages")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Number of messages to permit")))),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"In this mode it's possible to acknowledge messages in a different connection.")),(0,r.yg)("h4",{id:"check-if-reach-the-end-of-topic"},"Check if reach the end of topic"),(0,r.yg)("p",null,"Consumers can check if it has reached the end of a topic by sending the ",(0,r.yg)("inlineCode",{parentName:"p"},"isEndOfTopic")," request."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Request")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "isEndOfTopic"\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"type")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Type of command. Must be ",(0,r.yg)("inlineCode",{parentName:"td"},"isEndOfTopic"))))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Response")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n   "endOfTopic": "true/false"\n }\n')),(0,r.yg)("h3",{id:"reader-endpoint"},"Reader endpoint"),(0,r.yg)("p",null,"The reader endpoint requires you to specify a tenant, namespace, and topic in the URL:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"ws://broker-service-url:8080/ws/v2/reader/persistent/:tenant/:namespace/:topic\n")),(0,r.yg)("h5",{id:"query-param-2"},"Query param"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"readerName")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Reader name")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"receiverQueueSize")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Size of the consumer receive queue (default: 1000)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"int or enum"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID to start from, ",(0,r.yg)("inlineCode",{parentName:"td"},"earliest")," or ",(0,r.yg)("inlineCode",{parentName:"td"},"latest")," (default: ",(0,r.yg)("inlineCode",{parentName:"td"},"latest"),")")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"token")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Authentication token, this is used for the browser javascript client")))),(0,r.yg)("h5",{id:"receiving-messages"},"Receiving messages"),(0,r.yg)("p",null,"Server will push messages on the WebSocket session:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "messageId": "CAAQAw==",\n  "payload": "SGVsbG8gV29ybGQ=",\n  "properties": {"key1": "value1", "key2": "value2"},\n  "publishTime": "2016-08-30 16:45:57.785",\n  "redeliveryCount": 4\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"payload")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Base-64 encoded payload")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"publishTime")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Publish timestamp")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"redeliveryCount")),(0,r.yg)("td",{parentName:"tr",align:"left"},"number"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Number of times this message was already delivered")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"properties")),(0,r.yg)("td",{parentName:"tr",align:"left"},"key-value pairs"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Application-defined properties")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"key")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"no"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Original routing key set by producer")))),(0,r.yg)("h4",{id:"acknowledging-the-message"},"Acknowledging the message"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"In WebSocket"),", Reader needs to acknowledge the successful processing of the message to have the Pulsar WebSocket service update the number of pending messages.\nIf you don't send acknowledgments, Pulsar WebSocket service will stop sending messages after reaching the ",(0,r.yg)("inlineCode",{parentName:"p"},"pendingMessages")," limit."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "messageId": "CAAQAw=="\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"messageId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Message ID of the processed message")))),(0,r.yg)("h4",{id:"check-if-reach-the-end-of-topic-1"},"Check if reach the end of topic"),(0,r.yg)("p",null,"Consumers can check if it has reached the end of a topic by sending the ",(0,r.yg)("inlineCode",{parentName:"p"},"isEndOfTopic")," request."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Request")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "isEndOfTopic"\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Key"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Required?"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Explanation"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"type")),(0,r.yg)("td",{parentName:"tr",align:"left"},"string"),(0,r.yg)("td",{parentName:"tr",align:"left"},"yes"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Type of command. Must be ",(0,r.yg)("inlineCode",{parentName:"td"},"isEndOfTopic"))))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Response")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n   "endOfTopic": "true/false"\n }\n')),(0,r.yg)("h3",{id:"error-codes"},"Error codes"),(0,r.yg)("p",null,"In case of error the server will close the WebSocket session using the\nfollowing error codes:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Error Code"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Error Message"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"1"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Failed to create producer")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"2"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Failed to subscribe")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"3"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Failed to deserialize from JSON")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"4"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Failed to serialize to JSON")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"5"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Failed to authenticate client")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"6"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Client is not authorized")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"7"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Invalid payload encoding")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"8"),(0,r.yg)("td",{parentName:"tr",align:"left"},"Unknown error")))),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"The application is responsible for re-establishing a new WebSocket session after a backoff period.")),(0,r.yg)("h2",{id:"client-examples"},"Client examples"),(0,r.yg)("p",null,"Below you'll find code examples for the Pulsar WebSocket API in ",(0,r.yg)("a",{parentName:"p",href:"#python"},"Python")," and ",(0,r.yg)("a",{parentName:"p",href:"#nodejs"},"Node.js"),"."),(0,r.yg)("h3",{id:"python"},"Python"),(0,r.yg)("p",null,"This example uses the ",(0,r.yg)("a",{parentName:"p",href:"https://pypi.python.org/pypi/websocket-client"},(0,r.yg)("inlineCode",{parentName:"a"},"websocket-client"))," package. You can install it using ",(0,r.yg)("a",{parentName:"p",href:"https://pypi.python.org/pypi/pip"},"pip"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"pip install websocket-client\n")),(0,r.yg)("p",null,"You can also download it from ",(0,r.yg)("a",{parentName:"p",href:"https://pypi.python.org/pypi/websocket-client"},"PyPI"),"."),(0,r.yg)("h4",{id:"python-producer"},"Python producer"),(0,r.yg)("p",null,"Here's an example Python producer that sends a simple message to a Pulsar ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/reference-terminology#topic"},"topic"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"import websocket, base64, json\n\n# If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nenable_TLS = False\nscheme = 'ws'\nif enable_TLS:\n    scheme = 'wss'\n\nTOPIC = scheme + '://localhost:8080/ws/v2/producer/persistent/public/default/my-topic'\n\nws = websocket.create_connection(TOPIC)\n\n# encode message\ns = \"Hello World\"\nfirstEncoded = s.encode(\"UTF-8\")\nbinaryEncoded = base64.b64encode(firstEncoded)\npayloadString = binaryEncoded.decode('UTF-8')\n\n# Send one message as JSON\nws.send(json.dumps({\n    'payload' : payloadString,\n    'properties': {\n        'key1' : 'value1',\n        'key2' : 'value2'\n    },\n    'context' : 5\n}))\n\nresponse =  json.loads(ws.recv())\nif response['result'] == 'ok':\n    print( 'Message published successfully')\nelse:\n    print('Failed to publish message:', response)\nws.close()\n")),(0,r.yg)("h4",{id:"python-consumer"},"Python consumer"),(0,r.yg)("p",null,"Here's an example Python consumer that listens on a Pulsar topic and prints the message ID whenever a message arrives:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"import websocket, base64, json\n\n# If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nenable_TLS = False\nscheme = 'ws'\nif enable_TLS:\n    scheme = 'wss'\n\nTOPIC = scheme + '://localhost:8080/ws/v2/consumer/persistent/public/default/my-topic/my-sub'\n\nws = websocket.create_connection(TOPIC)\n\nwhile True:\n    msg = json.loads(ws.recv())\n    if not msg: break\n\n    print( \"Received: {} - payload: {}\".format(msg, base64.b64decode(msg['payload'])))\n\n    # Acknowledge successful processing\n    ws.send(json.dumps({'messageId' : msg['messageId']}))\n\nws.close()\n")),(0,r.yg)("h4",{id:"python-reader"},"Python reader"),(0,r.yg)("p",null,"Here's an example Python reader that listens on a Pulsar topic and prints the message ID whenever a message arrives:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"import websocket, base64, json\n\n# If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nenable_TLS = False\nscheme = 'ws'\nif enable_TLS:\n    scheme = 'wss'\n\nTOPIC = scheme + '://localhost:8080/ws/v2/reader/persistent/public/default/my-topic'\nws = websocket.create_connection(TOPIC)\n\nwhile True:\n    msg = json.loads(ws.recv())\n    if not msg: break\n\n    print ( \"Received: {} - payload: {}\".format(msg, base64.b64decode(msg['payload'])))\n\n    # Acknowledge successful processing\n    ws.send(json.dumps({'messageId' : msg['messageId']}))\n\nws.close()\n")),(0,r.yg)("h3",{id:"nodejs"},"Node.js"),(0,r.yg)("p",null,"This example uses the ",(0,r.yg)("a",{parentName:"p",href:"https://websockets.github.io/ws/"},(0,r.yg)("inlineCode",{parentName:"a"},"ws"))," package. You can install it using ",(0,r.yg)("a",{parentName:"p",href:"https://www.npmjs.com/"},"npm"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"npm install ws\n")),(0,r.yg)("h4",{id:"nodejs-producer"},"Node.js producer"),(0,r.yg)("p",null,"Here's an example Node.js producer that sends a simple message to a Pulsar topic:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},'const WebSocket = require(\'ws\');\n\n// If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nconst enableTLS = false;\nconst topic = `${enableTLS ? \'wss\' : \'ws\'}://localhost:8080/ws/v2/producer/persistent/public/default/my-topic`;\nconst ws = new WebSocket(topic);\n\nvar message = {\n  "payload" : new Buffer("Hello World").toString(\'base64\'),\n  "properties": {\n    "key1" : "value1",\n    "key2" : "value2"\n  },\n  "context" : "1"\n};\n\nws.on(\'open\', function() {\n  // Send one message\n  ws.send(JSON.stringify(message));\n});\n\nws.on(\'message\', function(message) {\n  console.log(\'received ack: %s\', message);\n});\n')),(0,r.yg)("h4",{id:"nodejs-consumer"},"Node.js consumer"),(0,r.yg)("p",null,"Here's an example Node.js consumer that listens on the same topic used by the producer above:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"const WebSocket = require('ws');\n\n// If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nconst enableTLS = false;\nconst topic = `${enableTLS ? 'wss' : 'ws'}://localhost:8080/ws/v2/consumer/persistent/public/default/my-topic/my-sub`;\nconst ws = new WebSocket(topic);\n\nws.on('message', function(message) {\n    var receiveMsg = JSON.parse(message);\n    console.log('Received: %s - payload: %s', message, new Buffer(receiveMsg.payload, 'base64').toString());\n    var ackMsg = {\"messageId\" : receiveMsg.messageId};\n    ws.send(JSON.stringify(ackMsg));\n});\n")),(0,r.yg)("h4",{id:"nodejs-reader"},"NodeJS reader"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"const WebSocket = require('ws');\n\n// If set enableTLS to true, your have to set tlsEnabled to true in conf/websocket.conf.\nconst enableTLS = false;\nconst topic = `${enableTLS ? 'wss' : 'ws'}://localhost:8080/ws/v2/reader/persistent/public/default/my-topic`;\nconst ws = new WebSocket(topic);\n\nws.on('message', function(message) {\n    var receiveMsg = JSON.parse(message);\n    console.log('Received: %s - payload: %s', message, new Buffer(receiveMsg.payload, 'base64').toString());\n    var ackMsg = {\"messageId\" : receiveMsg.messageId};\n    ws.send(JSON.stringify(ackMsg));\n});\n")))}y.isMDXComponent=!0}}]);