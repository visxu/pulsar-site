"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[79523],{15680:(e,a,n)=>{n.d(a,{xA:()=>c,yg:()=>g});var t=n(96540);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=t.createContext({}),p=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},c=function(e){var a=p(e.components);return t.createElement(i.Provider,{value:a},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},d=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,g=u["".concat(i,".").concat(d)]||u[d]||m[d]||o;return n?t.createElement(g,s(s({ref:a},c),{},{components:n})):t.createElement(g,s({ref:a},c))}));function g(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l[u]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},12172:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var t=n(58168),r=(n(96540),n(15680));const o={id:"io-debezium-source",title:"Debezium source connector",sidebar_label:"Debezium source connector"},s=void 0,l={unversionedId:"io-debezium-source",id:"io-debezium-source",title:"Debezium source connector",description:"You can download all the Pulsar connectors on download page.",source:"@site/docs/io-debezium-source.md",sourceDirName:".",slug:"/io-debezium-source",permalink:"/docs/next/io-debezium-source",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/docs/io-debezium-source.md",tags:[],version:"current",frontMatter:{id:"io-debezium-source",title:"Debezium source connector",sidebar_label:"Debezium source connector"}},i={},p=[{value:"Configuration",id:"configuration",level:2},{value:"Converter Options",id:"converter-options",level:3},{value:"MongoDB Configuration",id:"mongodb-configuration",level:3},{value:"Customize the Reader config for the metadata topics",id:"customize-the-reader-config-for-the-metadata-topics",level:3},{value:"Example of MySQL",id:"example-of-mysql",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Usage",id:"usage",level:3},{value:"Example of PostgreSQL",id:"example-of-postgresql",level:2},{value:"Configuration",id:"configuration-2",level:3},{value:"Usage",id:"usage-1",level:3},{value:"Example of MongoDB",id:"example-of-mongodb",level:2},{value:"Configuration",id:"configuration-3",level:3},{value:"Usage",id:"usage-2",level:3},{value:"Example of Oracle",id:"example-of-oracle",level:2},{value:"Packaging",id:"packaging",level:3},{value:"Configuration",id:"configuration-4",level:3},{value:"Example of Microsoft SQL",id:"example-of-microsoft-sql",level:2},{value:"Configuration",id:"configuration-5",level:3},{value:"FAQ",id:"faq",level:2},{value:"Debezium postgres connector will hang when creating snap",id:"debezium-postgres-connector-will-hang-when-creating-snap",level:3}],c={toc:p},u="wrapper";function m(e){let{components:a,...n}=e;return(0,r.yg)(u,(0,t.A)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"You can download all the Pulsar connectors on ",(0,r.yg)("a",{parentName:"p",href:"pathname:///download"},"download page"),".")),(0,r.yg)("p",null,"The Debezium source connector pulls messages from MySQL or PostgreSQL and persists the messages to Pulsar topics."),(0,r.yg)("h2",{id:"configuration"},"Configuration"),(0,r.yg)("p",null,"The configuration of the Debezium source connector has the following properties."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Default"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"task.class")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"A source task class that implemented in Debezium.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.hostname")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The address of a database server.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.port")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The port number of a database server.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.user")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The name of a database user that has the required privileges.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.password")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The password for a database user that has the required privileges.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.server.id")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The connector's identifier that must be unique within a database cluster and similar to the database's server-id configuration property.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.server.name")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The logical name of a database server/cluster, which forms a namespace and it is used in all the names of Kafka topics to which the connector writes, the Kafka Connect schema names, and the namespaces of the corresponding Avro schema when the Avro Connector is used.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.whitelist")),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"A list of all databases hosted by this server which is monitored by the  connector.",(0,r.yg)("br",null),(0,r.yg)("br",null)," This is optional, and there are other properties for listing databases and tables to include or exclude from monitoring.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"key.converter")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The converter provided by Kafka Connect to convert record key.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"value.converter")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The converter provided by Kafka Connect to convert record value.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.history")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The name of the database history class.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.history.pulsar.topic")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The name of the database history topic where the connector writes and recovers DDL statements. ",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Note: this topic is for internal use only and should not be used by consumers."))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.history.pulsar.service.url")),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"Pulsar cluster service URL for history topic. ",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Note"),": If ",(0,r.yg)("inlineCode",{parentName:"td"},"database.history.pulsar.service.url")," is not set, then the database history Pulsar client will use the same client settings as those of the source connector, such as ",(0,r.yg)("inlineCode",{parentName:"td"},"client_auth_plugin")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"client_auth_params"),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"offset.storage.topic")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"Record the last committed offsets that the connector successfully completes.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"json-with-envelope")),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"Present the message that only consists of payload.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"database.history.pulsar.reader.config")),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The configs of the reader for the database schema history topic, in the form of a JSON string with key-value pairs.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"offset.storage.reader.config")),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The configs of the reader for the kafka connector offsets topic, in the form of a JSON string with key-value pairs.")))),(0,r.yg)("h3",{id:"converter-options"},"Converter Options"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"org.apache.kafka.connect.json.JsonConverter")),(0,r.yg)("p",null,"This config ",(0,r.yg)("inlineCode",{parentName:"p"},"json-with-envelope")," is valid only for the JsonConverter. The default value is false, and the consumer uses the schema ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.KeyValue(Schema.AUTO_CONSUME(), Schema.AUTO_CONSUME(), KeyValueEncodingType.SEPARATED)"),", and the message only consist of payload."),(0,r.yg)("p",null,"If the config ",(0,r.yg)("inlineCode",{parentName:"p"},"json-with-envelope")," value is true, the consumer uses the schema ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.KeyValue(Schema.BYTES, Schema.BYTES"),", the message consists of schema and payload."),(0,r.yg)("ol",{start:2},(0,r.yg)("li",{parentName:"ol"},"org.apache.pulsar.kafka.shade.io.confluent.connect.avro.AvroConverter")),(0,r.yg)("p",null,"If users select the AvroConverter, then the pulsar consumer should use the schema ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.KeyValue(Schema.AUTO_CONSUME(),\nSchema.AUTO_CONSUME(), KeyValueEncodingType.SEPARATED)"),", and the message consist of payload."),(0,r.yg)("h3",{id:"mongodb-configuration"},"MongoDB Configuration"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"),(0,r.yg)("th",{parentName:"tr",align:null},"Default"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"mongodb.hosts")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The comma-separated list of hostname and port pairs (in the form 'host' or 'host:port') of the MongoDB servers in the replica set. The list contains a single hostname and a port pair. If mongodb.members.auto.discover is set to false, the host and port pair are prefixed with the replica set name (e.g., rs0/localhost:27017).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"mongodb.name")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"A unique name that identifies the connector and/or MongoDB replica set or shared cluster that this connector monitors. Each server should be monitored by at most one Debezium connector, since this server name prefixes all persisted Kafka topics emanating from the MongoDB replica set or cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"mongodb.user")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"Name of the database user to be used when connecting to MongoDB. This is required only when MongoDB is configured to use authentication.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"mongodb.password")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"Password to be used when connecting to MongoDB. This is required only when MongoDB is configured to use authentication.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"mongodb.task.id")),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},"null"),(0,r.yg)("td",{parentName:"tr",align:null},"The taskId of the MongoDB connector that attempts to use a separate task for each replica set.")))),(0,r.yg)("h3",{id:"customize-the-reader-config-for-the-metadata-topics"},"Customize the Reader config for the metadata topics"),(0,r.yg)("p",null,"The Debezium Connector exposes ",(0,r.yg)("inlineCode",{parentName:"p"},"database.history.pulsar.reader.config")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"offset.storage.reader.config")," to configure the reader of database schema history topic and the Kafka connector offsets topic. For example, it can be used to configure the subscription name and other reader configurations. You can find the available configurations at ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ReaderConfigurationData.java"},"ReaderConfigurationData"),"."),(0,r.yg)("p",null,"For example, to configure the subscription name for both Readers, you can add the following configuration:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"JSON"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "configs": {\n     "database.history.pulsar.reader.config": "{\\"subscriptionName\\":\\"history-reader\\"}",\n     "offset.storage.reader.config": "{\\"subscriptionName\\":\\"offset-reader\\"}",\n  }\n}\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"YAML"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'configs:\n   database.history.pulsar.reader.config: "{\\"subscriptionName\\":\\"history-reader\\"}"\n   offset.storage.reader.config: "{\\"subscriptionName\\":\\"offset-reader\\"}"\n')))),(0,r.yg)("h2",{id:"example-of-mysql"},"Example of MySQL"),(0,r.yg)("p",null,"You need to create a configuration file before using the Pulsar Debezium connector."),(0,r.yg)("h3",{id:"configuration-1"},"Configuration"),(0,r.yg)("p",null,"You can use one of the following methods to create a configuration file."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"JSON"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n   "configs": {\n      "database.hostname": "localhost",\n      "database.port": "3306",\n      "database.user": "debezium",\n      "database.password": "dbz",\n      "database.server.id": "184054",\n      "database.server.name": "dbserver1",\n      "database.whitelist": "inventory",\n      "database.history": "org.apache.pulsar.io.debezium.PulsarDatabaseHistory",\n      "database.history.pulsar.topic": "history-topic",\n      "database.history.pulsar.service.url": "pulsar://127.0.0.1:6650",\n      "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n      "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n      "offset.storage.topic": "offset-topic"\n   }\n}\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"YAML"),(0,r.yg)("p",{parentName:"li"},"You can create a ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-mysql-source-config.yaml")," file and copy the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-io/debezium/mysql/src/main/resources/debezium-mysql-source-config.yaml"},"contents")," below to the ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-mysql-source-config.yaml")," file."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'tenant: "public"\nnamespace: "default"\nname: "debezium-mysql-source"\ntopicName: "debezium-mysql-topic"\narchive: "connectors/pulsar-io-debezium-mysql-3.3.2.nar"\nparallelism: 1\n\nconfigs:\n\n    ## config for mysql, docker image: debezium/example-mysql:0.8\n    database.hostname: "localhost"\n    database.port: "3306"\n    database.user: "debezium"\n    database.password: "dbz"\n    database.server.id: "184054"\n    database.server.name: "dbserver1"\n    database.whitelist: "inventory"\n    database.history: "org.apache.pulsar.io.debezium.PulsarDatabaseHistory"\n    database.history.pulsar.topic: "history-topic"\n    database.history.pulsar.service.url: "pulsar://127.0.0.1:6650"\n\n    ## KEY_CONVERTER_CLASS_CONFIG, VALUE_CONVERTER_CLASS_CONFIG\n    key.converter: "org.apache.kafka.connect.json.JsonConverter"\n    value.converter: "org.apache.kafka.connect.json.JsonConverter"\n\n    ## OFFSET_STORAGE_TOPIC_CONFIG\n    offset.storage.topic: "offset-topic"\n')))),(0,r.yg)("h3",{id:"usage"},"Usage"),(0,r.yg)("p",null,"This example shows how to change the data of a MySQL table using the Pulsar Debezium connector."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a MySQL server with a database from which Debezium can capture changes."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker run -it --rm \\\n--name mysql \\\n-p 3306:3306 \\\n-e MYSQL_ROOT_PASSWORD=debezium \\\n-e MYSQL_USER=mysqluser \\\n-e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:0.8\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a Pulsar service locally in standalone mode."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar standalone\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start the Pulsar Debezium connector in local run mode using one of the following methods."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"JSON")," configuration file as shown previously."),(0,r.yg)("p",{parentName:"li"},"  Make sure the NAR file is available at ",(0,r.yg)("inlineCode",{parentName:"p"},"connectors/pulsar-io-debezium-mysql-3.3.2.nar"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-admin source localrun \\\n    --archive $PWD/connectors/pulsar-io-debezium-mysql-3.3.2.nar \\\n    --name debezium-mysql-source \\\n    --tenant public \\\n    --namespace default \\\n    --source-config \'{"database.hostname": "localhost","database.port": "3306","database.user": "debezium","database.password": "dbz","database.server.id": "184054","database.server.name": "dbserver1","database.whitelist": "inventory","database.history": "org.apache.pulsar.io.debezium.PulsarDatabaseHistory","database.history.pulsar.topic": "history-topic","database.history.pulsar.service.url": "pulsar://127.0.0.1:6650","key.converter": "org.apache.kafka.connect.json.JsonConverter","value.converter": "org.apache.kafka.connect.json.JsonConverter","pulsar.service.url": "pulsar://127.0.0.1:6650","offset.storage.topic": "offset-topic"}\'\n')),(0,r.yg)("admonition",{parentName:"li",type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The Debezium connector saves data in the following 4 types of topics:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"One topic named with the database server name (",(0,r.yg)("inlineCode",{parentName:"li"},"database.server.name"),") for storing the database metadata messages, such as ",(0,r.yg)("inlineCode",{parentName:"li"},"public/default/database.server.name"),"."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"database.history.pulsar.topic"),") for storing the database history information. The connector writes and recovers DDL statements on this topic."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"offset.storage.topic"),") for storing the offset metadata messages. The connector saves the last successfully-committed offsets on this topic."),(0,r.yg)("li",{parentName:"ul"},"One per-table topic. The connector writes change events for all operations that occur in a table to a single Pulsar topic that is specific to that table.")),(0,r.yg)("p",{parentName:"admonition"},"If the automatic topic creation is disabled on your broker, you need to manually create the above 4 types of topics."))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"YAML")," configuration file as shown previously."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin source localrun \\\n   --source-config-file $PWD/debezium-mysql-source-config.yaml\n"))))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Subscribe to the topic ",(0,r.yg)("em",{parentName:"p"},"sub-products")," for the table ",(0,r.yg)("em",{parentName:"p"},"inventory.products"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-client consume -s "sub-products" public/default/dbserver1.inventory.products -n 0\n'))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a MySQL client in docker."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'docker run -it --rm \\\n    --name mysqlterm \\\n    --link mysql \\\n    --rm mysql:5.7 sh \\\n    -c \'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"\'\n'))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"A MySQL client pops out."),(0,r.yg)("p",{parentName:"li"},"Change the connection mode to ",(0,r.yg)("inlineCode",{parentName:"p"},"mysql_native_password"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre"},'mysql> show variables like "caching_sha2_password_auto_generate_rsa_keys";\n+----------------------------------------------+-------+\n| Variable_name                                | Value |\n+----------------------------------------------+-------+\n| caching_sha2_password_auto_generate_rsa_keys | ON    |\n+----------------------------------------------+-------+\n\n# If the value of "caching_sha2_password_auto_generate_rsa_keys" is ON, ensure the plugin of mysql.user is "mysql_native_password".\nmysql> SELECT Host, User, plugin from mysql.user where user={user};\n+-----------+------+-----------------------+\n| Host      | User | plugin                |\n+-----------+------+-----------------------+\n| localhost | root | caching_sha2_password |\n+-----------+------+-----------------------+\n\n# If the plugin of mysql.user is is "caching_sha2_password", set it to "mysql_native_password".\nalter user \'{user}\'@\'{host}\' identified with mysql_native_password by {password};\n\n# Check the plugin of mysql.user.\nmysql> SELECT Host, User, plugin from mysql.user where user={user};\n+-----------+------+-----------------------+\n| Host      | User | plugin                |\n+-----------+------+-----------------------+\n| localhost | root | mysql_native_password |\n+-----------+------+-----------------------+\n')),(0,r.yg)("p",{parentName:"li"},"Use the following commands to change the data of the table ",(0,r.yg)("em",{parentName:"p"},"products"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"mysql> use inventory;\nmysql> show tables;\nmysql> SELECT * FROM  products;\nmysql> UPDATE products SET name='1111111111' WHERE id=101;\nmysql> UPDATE products SET name='1111111111' WHERE id=107;\n")),(0,r.yg)("p",{parentName:"li"},"In the terminal window of subscribing topic, you can find the data changes have been kept in the ",(0,r.yg)("em",{parentName:"p"},"sub-products")," topic."))),(0,r.yg)("h2",{id:"example-of-postgresql"},"Example of PostgreSQL"),(0,r.yg)("p",null,"You need to create a configuration file before using the Pulsar Debezium connector."),(0,r.yg)("h3",{id:"configuration-2"},"Configuration"),(0,r.yg)("p",null,"You can use one of the following methods to create a configuration file."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"JSON"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "database.hostname": "localhost",\n    "database.port": "5432",\n    "database.user": "postgres",\n    "database.password": "changeme",\n    "database.dbname": "postgres",\n    "database.server.name": "dbserver1",\n    "plugin.name": "pgoutput",\n    "schema.whitelist": "public",\n    "table.whitelist": "public.users",\n    "database.history.pulsar.service.url": "pulsar://127.0.0.1:6650"\n}\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"YAML"),(0,r.yg)("p",{parentName:"li"},"You can create a ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-postgres-source-config.yaml")," file and copy the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-io/debezium/postgres/src/main/resources/debezium-postgres-source-config.yaml"},"contents")," below to the ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-postgres-source-config.yaml")," file."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'tenant: "public"\nnamespace: "default"\nname: "debezium-postgres-source"\ntopicName: "debezium-postgres-topic"\narchive: "connectors/pulsar-io-debezium-postgres-3.3.2.nar"\nparallelism: 1\n\nconfigs:\n    ## config for postgres version 10+, official docker image: postgres:<10+>\n    database.hostname: "localhost"\n    database.port: "5432"\n    database.user: "postgres"\n    database.password: "changeme"\n    database.dbname: "postgres"\n    database.server.name: "dbserver1"\n    plugin.name: "pgoutput"\n    schema.whitelist: "public"\n    table.whitelist: "public.users"\n\n    ## PULSAR_SERVICE_URL_CONFIG\n    database.history.pulsar.service.url: "pulsar://127.0.0.1:6650"\n')))),(0,r.yg)("p",null,"Notice that ",(0,r.yg)("inlineCode",{parentName:"p"},"pgoutput")," is a standard plugin of Postgres introduced in version 10 - see ",(0,r.yg)("a",{parentName:"p",href:"https://www.postgresql.org/docs/10/logical-replication-architecture.html"},"Postgres architecture docu"),". You don't need to install anything, just make sure the WAL level is set to ",(0,r.yg)("inlineCode",{parentName:"p"},"logical")," (see docker command below and ",(0,r.yg)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/runtime-config-wal.html"},"Postgres docu"),")."),(0,r.yg)("h3",{id:"usage-1"},"Usage"),(0,r.yg)("p",null,"This example shows how to change the data of a PostgreSQL table using the Pulsar Debezium connector."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a PostgreSQL server with a database from which Debezium can capture changes."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker run -d -it --rm \\\n    --name pulsar-postgres \\\n    -p 5432:5432 \\\n    -e POSTGRES_PASSWORD=changeme \\\n    postgres:13.3 -c wal_level=logical\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a Pulsar service locally in standalone mode."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar standalone\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start the Pulsar Debezium connector in local run mode using one of the following methods."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"JSON")," configuration file as shown previously."),(0,r.yg)("p",{parentName:"li"},"Make sure the NAR file is available at ",(0,r.yg)("inlineCode",{parentName:"p"},"connectors/pulsar-io-debezium-postgres-3.3.2.nar"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-admin source localrun \\\n    --archive $PWD/connectors/pulsar-io-debezium-postgres-3.3.2.nar \\\n    --name debezium-postgres-source \\\n    --tenant public \\\n    --namespace default \\\n    --source-config \'{"database.hostname": "localhost","database.port": "5432","database.user": "postgres","database.password": "changeme","database.dbname": "postgres","database.server.name": "dbserver1","plugin.name": "pgoutput","schema.whitelist": "public","table.whitelist": "public.users","pulsar.service.url": "pulsar://127.0.0.1:6650"}\'\n')),(0,r.yg)("admonition",{parentName:"li",type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The Debezium connector saves data in the following 4 types of topics:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"One topic named with the database server name (",(0,r.yg)("inlineCode",{parentName:"li"},"database.server.name"),") for storing the database metadata messages, such as ",(0,r.yg)("inlineCode",{parentName:"li"},"public/default/database.server.name"),"."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"database.history.pulsar.topic"),") for storing the database history information. The connector writes and recovers DDL statements on this topic."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"offset.storage.topic"),") for storing the offset metadata messages. The connector saves the last successfully-committed offsets on this topic."),(0,r.yg)("li",{parentName:"ul"},"One per-table topic. The connector writes change events for all operations that occur in a table to a single Pulsar topic that is specific to that table.")),(0,r.yg)("p",{parentName:"admonition"},"If the automatic topic creation is disabled on your broker, you need to manually create the above 4 types of topics."))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"YAML")," configuration file as shown previously."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin source localrun  \\\n   --source-config-file $PWD/debezium-postgres-source-config.yaml\n"))))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Subscribe to the topic ",(0,r.yg)("em",{parentName:"p"},"sub-users")," for the ",(0,r.yg)("em",{parentName:"p"},"public.users")," table."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-client consume -s "sub-users" public/default/dbserver1.public.users -n 0\n'))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a PostgreSQL client in docker."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker exec -it pulsar-postgres /bin/bash\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"A PostgreSQL client pops out."),(0,r.yg)("p",{parentName:"li"},"Use the following commands to create sample data in the table ",(0,r.yg)("em",{parentName:"p"},"users"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"psql -U postgres -h localhost -p 5432\nPassword for user postgres:\n\nCREATE TABLE users(\n  id BIGINT GENERATED ALWAYS AS IDENTITY, PRIMARY KEY(id),\n  hash_firstname TEXT NOT NULL,\n  hash_lastname TEXT NOT NULL,\n  gender VARCHAR(6) NOT NULL CHECK (gender IN ('male', 'female'))\n);\n\nINSERT INTO users(hash_firstname, hash_lastname, gender)\n  SELECT md5(RANDOM()::TEXT), md5(RANDOM()::TEXT), CASE WHEN RANDOM() < 0.5 THEN 'male' ELSE 'female' END FROM generate_series(1, 100);\n\npostgres=# select * from users;\n\n  id   |          hash_firstname          |          hash_lastname           | gender\n-------+----------------------------------+----------------------------------+--------\n     1 | 02bf7880eb489edc624ba637f5ab42bd | 3e742c2cc4217d8e3382cc251415b2fb | female\n     2 | dd07064326bb9119189032316158f064 | 9c0e938f9eddbd5200ba348965afbc61 | male\n     3 | 2c5316fdd9d6595c1cceb70eed12e80c | 8a93d7d8f9d76acfaaa625c82a03ea8b | female\n     4 | 3dfa3b4f70d8cd2155567210e5043d2b | 32c156bc28f7f03ab5d28e2588a3dc19 | female\n")))),(0,r.yg)("p",null,"   postgres=# UPDATE users SET hash_firstname='maxim' WHERE id=1;\nUPDATE 1"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\nIn the terminal window of subscribing topic, you can receive the following messages.\n\n```bash\n----- got message -----\n{"before":null,"after":{"id":1,"hash_firstname":"maxim","hash_lastname":"292113d30a3ccee0e19733dd7f88b258","gender":"male"},"source:{"version":"1.0.0.Final","connector":"postgresql","name":"foobar","ts_ms":1624045862644,"snapshot":"false","db":"postgres","schema":"public","table":"users","txId":595,"lsn":24419784,"xmin":null},"op":"u","ts_ms":1624045862648}\n...many more\n')),(0,r.yg)("h2",{id:"example-of-mongodb"},"Example of MongoDB"),(0,r.yg)("p",null,"You need to create a configuration file before using the Pulsar Debezium connector."),(0,r.yg)("h3",{id:"configuration-3"},"Configuration"),(0,r.yg)("p",null,"You can use one of the following methods to create a configuration file."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"JSON"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "mongodb.hosts": "rs0/mongodb:27017",\n    "mongodb.name": "dbserver1",\n    "mongodb.user": "debezium",\n    "mongodb.password": "dbz",\n    "mongodb.task.id": "1",\n    "database.whitelist": "inventory",\n    "database.history.pulsar.service.url": "pulsar://127.0.0.1:6650"\n}\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"YAML"),(0,r.yg)("p",{parentName:"li"},"You can create a ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-mongodb-source-config.yaml")," file and copy the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-io/debezium/mongodb/src/main/resources/debezium-mongodb-source-config.yaml"},"contents")," below to the ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-mongodb-source-config.yaml")," file."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'tenant: "public"\nnamespace: "default"\nname: "debezium-mongodb-source"\ntopicName: "debezium-mongodb-topic"\narchive: "connectors/pulsar-io-debezium-mongodb-3.3.2.nar"\nparallelism: 1\n\nconfigs:\n\n    ## config for pg, docker image: debezium/example-mongodb:0.10\n    mongodb.hosts: "rs0/mongodb:27017"\n    mongodb.name: "dbserver1"\n    mongodb.user: "debezium"\n    mongodb.password: "dbz"\n    mongodb.task.id: "1"\n    database.whitelist: "inventory"\n    database.history.pulsar.service.url: "pulsar://127.0.0.1:6650"\n')))),(0,r.yg)("h3",{id:"usage-2"},"Usage"),(0,r.yg)("p",null,"This example shows how to change the data of a MongoDB table using the Pulsar Debezium connector."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a MongoDB server with a database from which Debezium can capture changes."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker pull debezium/example-mongodb:0.10\ndocker run -d -it --rm --name pulsar-mongodb -e MONGODB_USER=mongodb -e MONGODB_PASSWORD=mongodb -p 27017:27017  debezium/example-mongodb:0.10\n")),(0,r.yg)("p",{parentName:"li"},"Use the following commands to initialize the data."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"./usr/local/bin/init-inventory.sh\n")),(0,r.yg)("p",{parentName:"li"},"If the local host cannot access the container network, you can update the file ",(0,r.yg)("inlineCode",{parentName:"p"},"/etc/hosts")," and add a rule ",(0,r.yg)("inlineCode",{parentName:"p"},"127.0.0.1 6 f114527a95f"),". f114527a95f is container id, you can try to get by using",(0,r.yg)("inlineCode",{parentName:"p"},"docker ps -a"),"."))),(0,r.yg)("ol",{start:2},(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a Pulsar service locally in standalone mode."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar standalone\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start the Pulsar Debezium connector in local run mode using one of the following methods."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"JSON")," configuration file as shown previously."),(0,r.yg)("p",{parentName:"li"}," Make sure the NAR file is available at ",(0,r.yg)("inlineCode",{parentName:"p"},"connectors/pulsar-io-mongodb-3.3.2.nar"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-admin source localrun \\\n    --archive $PWD/connectors/pulsar-io-debezium-mongodb-3.3.2.nar \\\n    --name debezium-mongodb-source \\\n    --tenant public \\\n    --namespace default \\\n    --source-config \'{"mongodb.hosts": "rs0/mongodb:27017","mongodb.name": "dbserver1","mongodb.user": "debezium","mongodb.password": "dbz","mongodb.task.id": "1","database.whitelist": "inventory","database.history.pulsar.service.url": "pulsar://127.0.0.1:6650"}\'\n')),(0,r.yg)("admonition",{parentName:"li",type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The Debezium connector saves data in the following 4 types of topics:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"One topic named with the database server name ( ",(0,r.yg)("inlineCode",{parentName:"li"},"database.server.name"),") for storing the database metadata messages, such as ",(0,r.yg)("inlineCode",{parentName:"li"},"public/default/database.server.name"),"."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"database.history.pulsar.topic"),") for storing the database history information. The connector writes and recovers DDL statements on this topic."),(0,r.yg)("li",{parentName:"ul"},"One topic (",(0,r.yg)("inlineCode",{parentName:"li"},"offset.storage.topic"),") for storing the offset metadata messages. The connector saves the last successfully-committed offsets on this topic."),(0,r.yg)("li",{parentName:"ul"},"One per-table topic. The connector writes change events for all operations that occur in a table to a single Pulsar topic that is specific to that table.")),(0,r.yg)("p",{parentName:"admonition"},"If the automatic topic creation is disabled on your broker, you need to manually create the above 4 types of topics."))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Use the ",(0,r.yg)("strong",{parentName:"p"},"YAML")," configuration file as shown previously."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"bin/pulsar-admin source localrun  \\\n--source-config-file $PWD/debezium-mongodb-source-config.yaml\n"))))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Subscribe to the topic ",(0,r.yg)("em",{parentName:"p"},"sub-products")," for the ",(0,r.yg)("em",{parentName:"p"},"inventory.products")," table."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'bin/pulsar-client consume -s "sub-products" public/default/dbserver1.inventory.products -n 0\n'))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Start a MongoDB client in docker."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker exec -it pulsar-mongodb /bin/bash\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"A MongoDB client pops out."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'mongo -u debezium -p dbz --authenticationDatabase admin localhost:27017/inventory\ndb.products.update({"_id":NumberLong(104)},{$set:{weight:1.25}})\n')),(0,r.yg)("p",{parentName:"li"},"In the terminal window of subscribing topic, you can receive the following messages."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-text"},'----- got message -----\n{"schema":{"type":"struct","fields":[{"type":"string","optional":false,"field":"id"}],"optional":false,"name":"dbserver1.inventory.products.Key"},"payload":{"id":"104"}}, value = {"schema":{"type":"struct","fields":[{"type":"string","optional":true,"name":"io.debezium.data.Json","version":1,"field":"after"},{"type":"string","optional":true,"name":"io.debezium.data.Json","version":1,"field":"patch"},{"type":"struct","fields":[{"type":"string","optional":false,"field":"version"},{"type":"string","optional":false,"field":"connector"},{"type":"string","optional":false,"field":"name"},{"type":"int64","optional":false,"field":"ts_ms"},{"type":"string","optional":true,"name":"io.debezium.data.Enum","version":1,"parameters":{"allowed":"true,last,false"},"default":"false","field":"snapshot"},{"type":"string","optional":false,"field":"db"},{"type":"string","optional":false,"field":"rs"},{"type":"string","optional":false,"field":"collection"},{"type":"int32","optional":false,"field":"ord"},{"type":"int64","optional":true,"field":"h"}],"optional":false,"name":"io.debezium.connector.mongo.Source","field":"source"},{"type":"string","optional":true,"field":"op"},{"type":"int64","optional":true,"field":"ts_ms"}],"optional":false,"name":"dbserver1.inventory.products.Envelope"},"payload":{"after":"{\\"_id\\": {\\"$numberLong\\": \\"104\\"},\\"name\\": \\"hammer\\",\\"description\\": \\"12oz carpenter\'s hammer\\",\\"weight\\": 1.25,\\"quantity\\": 4}","patch":null,"source":{"version":"0.10.0.Final","connector":"mongodb","name":"dbserver1","ts_ms":1573541905000,"snapshot":"true","db":"inventory","rs":"rs0","collection":"products","ord":1,"h":4983083486544392763},"op":"r","ts_ms":1573541909761}}.\n')))),(0,r.yg)("h2",{id:"example-of-oracle"},"Example of Oracle"),(0,r.yg)("h3",{id:"packaging"},"Packaging"),(0,r.yg)("p",null,"Oracle connector does not include Oracle JDBC driver and you need to package it with the connector.\nMajor reasons for not including the drivers are the variety of versions and Oracle licensing. It is recommended to use the driver provided with your Oracle DB installation, or you can ",(0,r.yg)("a",{parentName:"p",href:"https://www.oracle.com/database/technologies/appdev/jdbc.html"},"download")," one.\nIntegration tests have an ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/e2bc52d40450fa00af258c4432a5b71d50a5c6e0/tests/docker-images/latest-version-image/Dockerfile#L110-L122"},"example")," of packaging the driver into the connector NAR file."),(0,r.yg)("h3",{id:"configuration-4"},"Configuration"),(0,r.yg)("p",null,"Debezium ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/oracle.html#oracle-overview"},"requires")," Oracle DB with LogMiner or XStream API enabled.\nSupported options and steps for enabling them vary from version to version of Oracle DB.\nThe steps outlined in the ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/oracle.html#oracle-overview"},"documentation")," and used in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/debezium/DebeziumOracleDbSourceTester.java"},"integration test")," may or may not work for the version and edition of Oracle DB you are using.\nPlease refer to the ",(0,r.yg)("a",{parentName:"p",href:"https://docs.oracle.com/en/database/oracle/oracle-database/"},"documentation for Oracle DB")," as needed."),(0,r.yg)("p",null,"Similarly to other connectors, you can use JSON or YAML to configure the connector.\nUsing YAML as an example, you can create a ",(0,r.yg)("inlineCode",{parentName:"p"},"debezium-oracle-source-config.yaml")," file like:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"JSON")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "database.hostname": "localhost",\n  "database.port": "1521",\n  "database.user": "dbzuser",\n  "database.password": "dbz",\n  "database.dbname": "XE",\n  "database.server.name": "XE",\n  "schema.exclude.list": "system,dbzuser",\n  "snapshot.mode": "initial",\n  "topic.namespace": "public/default",\n  "task.class": "io.debezium.connector.oracle.OracleConnectorTask",\n  "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n  "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n  "typeClassName": "org.apache.pulsar.common.schema.KeyValue",\n  "database.history": "org.apache.pulsar.io.debezium.PulsarDatabaseHistory",\n  "database.tcpKeepAlive": "true",\n  "decimal.handling.mode": "double",\n  "database.history.pulsar.topic": "debezium-oracle-source-history-topic",\n  "database.history.pulsar.service.url": "pulsar://127.0.0.1:6650"\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"YAML")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'tenant: "public"\nnamespace: "default"\nname: "debezium-oracle-source"\ntopicName: "debezium-oracle-topic"\nparallelism: 1\n\nclassName: "org.apache.pulsar.io.debezium.oracle.DebeziumOracleSource"\ndatabase.dbname: "XE"\n\nconfigs:\n    database.hostname: "localhost"\n    database.port: "1521"\n    database.user: "dbzuser"\n    database.password: "dbz"\n    database.dbname: "XE"\n    database.server.name: "XE"\n    schema.exclude.list: "system,dbzuser"\n    snapshot.mode: "initial"\n    topic.namespace: "public/default"\n    task.class: "io.debezium.connector.oracle.OracleConnectorTask"\n    value.converter: "org.apache.kafka.connect.json.JsonConverter"\n    key.converter: "org.apache.kafka.connect.json.JsonConverter"\n    typeClassName: "org.apache.pulsar.common.schema.KeyValue"\n    database.history: "org.apache.pulsar.io.debezium.PulsarDatabaseHistory"\n    database.tcpKeepAlive: "true"\n    decimal.handling.mode: "double"\n    database.history.pulsar.topic: "debezium-oracle-source-history-topic"\n    database.history.pulsar.service.url: "pulsar://127.0.0.1:6650"\n')),(0,r.yg)("p",null,"For the full list of configuration properties supported by Debezium, see ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/oracle.html#oracle-connector-properties"},"Debezium Connector for Oracle"),"."),(0,r.yg)("h2",{id:"example-of-microsoft-sql"},"Example of Microsoft SQL"),(0,r.yg)("h3",{id:"configuration-5"},"Configuration"),(0,r.yg)("p",null,"Debezium ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/sqlserver.html#sqlserver-overview"},"requires")," SQL Server with CDC enabled.\nSteps outlined in the ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/sqlserver.html#setting-up-sqlserver"},"documentation")," and used in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/debezium/DebeziumMsSqlSourceTester.java"},"integration test"),".\nFor more information, see ",(0,r.yg)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server"},"Enable and disable change data capture in Microsoft SQL Server"),"."),(0,r.yg)("p",null,"Similarly to other connectors, you can use JSON or YAML to configure the connector."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"JSON")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "database.hostname": "localhost",\n  "database.port": "1433",\n  "database.user": "sa",\n  "database.password": "MyP@ssw0rd!",\n  "database.dbname": "MyTestDB",\n  "database.server.name": "mssql",\n  "snapshot.mode": "schema_only",\n  "topic.namespace": "public/default",\n  "task.class": "io.debezium.connector.sqlserver.SqlServerConnectorTask",\n  "value.converter": "org.apache.kafka.connect.json.JsonConverter",\n  "key.converter": "org.apache.kafka.connect.json.JsonConverter",\n  "typeClassName": "org.apache.pulsar.common.schema.KeyValue",\n  "database.history": "org.apache.pulsar.io.debezium.PulsarDatabaseHistory",\n  "database.tcpKeepAlive": "true",\n  "decimal.handling.mode": "double",\n  "database.history.pulsar.topic": "debezium-mssql-source-history-topic",\n  "database.history.pulsar.service.url": "pulsar://127.0.0.1:6650"\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"YAML")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'tenant: "public"\nnamespace: "default"\nname: "debezium-mssql-source"\ntopicName: "debezium-mssql-topic"\nparallelism: 1\n\nclassName: "org.apache.pulsar.io.debezium.mssql.DebeziumMsSqlSource"\ndatabase.dbname: "mssql"\n\nconfigs:\n    database.hostname: "localhost"\n    database.port: "1433"\n    database.user: "sa"\n    database.password: "MyP@ssw0rd!"\n    database.dbname: "MyTestDB"\n    database.server.name: "mssql"\n    snapshot.mode: "schema_only"\n    topic.namespace: "public/default"\n    task.class: "io.debezium.connector.sqlserver.SqlServerConnectorTask"\n    value.converter: "org.apache.kafka.connect.json.JsonConverter"\n    key.converter: "org.apache.kafka.connect.json.JsonConverter"\n    typeClassName: "org.apache.pulsar.common.schema.KeyValue"\n    database.history: "org.apache.pulsar.io.debezium.PulsarDatabaseHistory"\n    database.tcpKeepAlive: "true"\n    decimal.handling.mode: "double"\n    database.history.pulsar.topic: "debezium-mssql-source-history-topic"\n    database.history.pulsar.service.url: "pulsar://127.0.0.1:6650"\n')),(0,r.yg)("p",null,"For the full list of configuration properties supported by Debezium, see ",(0,r.yg)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/1.5/connectors/sqlserver.html#sqlserver-connector-properties"},"Debezium Connector for MS SQL"),"."),(0,r.yg)("h2",{id:"faq"},"FAQ"),(0,r.yg)("h3",{id:"debezium-postgres-connector-will-hang-when-creating-snap"},"Debezium postgres connector will hang when creating snap"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"#18 prio=5 os_prio=31 tid=0x00007fd83096f800 nid=0xa403 waiting on condition [0x000070000f534000]\n    java.lang.Thread.State: WAITING (parking)\n     at sun.misc.Unsafe.park(Native Method)\n     - parking to wait for  <0x00000007ab025a58> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n     at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n     at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\n     at java.util.concurrent.LinkedBlockingDeque.putLast(LinkedBlockingDeque.java:396)\n     at java.util.concurrent.LinkedBlockingDeque.put(LinkedBlockingDeque.java:649)\n     at io.debezium.connector.base.ChangeEventQueue.enqueue(ChangeEventQueue.java:132)\n     at io.debezium.connector.postgresql.PostgresConnectorTask$Lambda$203/385424085.accept(Unknown Source)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.sendCurrentRecord(RecordsSnapshotProducer.java:402)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.readTable(RecordsSnapshotProducer.java:321)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.lambda$takeSnapshot$6(RecordsSnapshotProducer.java:226)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer$Lambda$240/1347039967.accept(Unknown Source)\n     at io.debezium.jdbc.JdbcConnection.queryWithBlockingConsumer(JdbcConnection.java:535)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.takeSnapshot(RecordsSnapshotProducer.java:224)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.lambda$start$0(RecordsSnapshotProducer.java:87)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer$Lambda$206/589332928.run(Unknown Source)\n     at java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:705)\n     at java.util.concurrent.CompletableFuture.uniRunStage(CompletableFuture.java:717)\n     at java.util.concurrent.CompletableFuture.thenRun(CompletableFuture.java:2010)\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.start(RecordsSnapshotProducer.java:87)\n     at io.debezium.connector.postgresql.PostgresConnectorTask.start(PostgresConnectorTask.java:126)\n     at io.debezium.connector.common.BaseSourceTask.start(BaseSourceTask.java:47)\n     at org.apache.pulsar.io.kafka.connect.KafkaConnectSource.open(KafkaConnectSource.java:127)\n     at org.apache.pulsar.io.debezium.DebeziumSource.open(DebeziumSource.java:100)\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(JavaInstanceRunnable.java:690)\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:200)\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:230)\n     at java.lang.Thread.run(Thread.java:748)\n")),(0,r.yg)("p",null,"If you encounter the above problems in synchronizing data, please refer to ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/issues/4075"},"this")," and add the following configuration to the configuration file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"max.queue.size=\n")))}m.isMDXComponent=!0}}]);