"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[61933],{15680:(e,n,a)=>{a.d(n,{xA:()=>u,yg:()=>g});var t=a(96540);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=t.createContext({}),s=function(e){var n=t.useContext(c),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},u=function(e){var n=s(e.components);return t.createElement(c.Provider,{value:n},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},y=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(a),y=r,g=d["".concat(c,".").concat(y)]||d[y]||p[y]||o;return a?t.createElement(g,i(i({ref:n},u),{},{components:a})):t.createElement(g,i({ref:n},u))}));function g(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=y;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}y.displayName="MDXCreateElement"},288:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var t=a(58168),r=(a(96540),a(15680));const o={id:"security-bouncy-castle",title:"Bouncy Castle Providers",sidebar_label:"Bouncy Castle Providers",description:"Get a comprehensive understanding of concepts and packaging methods of BouncyCastle in Pulsar."},i=void 0,l={unversionedId:"security-bouncy-castle",id:"version-4.0.x/security-bouncy-castle",title:"Bouncy Castle Providers",description:"Get a comprehensive understanding of concepts and packaging methods of BouncyCastle in Pulsar.",source:"@site/versioned_docs/version-4.0.x/security-bouncy-castle.md",sourceDirName:".",slug:"/security-bouncy-castle",permalink:"/docs/4.0.x/security-bouncy-castle",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-4.0.x/security-bouncy-castle.md",tags:[],version:"4.0.x",frontMatter:{id:"security-bouncy-castle",title:"Bouncy Castle Providers",sidebar_label:"Bouncy Castle Providers",description:"Get a comprehensive understanding of concepts and packaging methods of BouncyCastle in Pulsar."},sidebar:"docsSidebar",previous:{title:"TLS Encryption",permalink:"/docs/4.0.x/security-tls-transport"},next:{title:"Authentication using mTLS",permalink:"/docs/4.0.x/security-tls-authentication"}},c={},s=[{value:"BouncyCastle Introduce",id:"bouncycastle-introduce",level:2},{value:"How BouncyCastle modules packaged in Pulsar",id:"how-bouncycastle-modules-packaged-in-pulsar",level:2},{value:"Include dependencies of BC-non-FIPS",id:"include-dependencies-of-bc-non-fips",level:3},{value:"Modules that include BC-non-FIPS module (<code>bouncy-castle-bc</code>)",id:"modules-that-include-bc-non-fips-module-bouncy-castle-bc",level:3},{value:"Module BC-FIPS (<code>bouncy-castle-bcfips</code>)",id:"module-bc-fips-bouncy-castle-bcfips",level:3},{value:"Exclude BC-non-FIPS and include BC-FIPS",id:"exclude-bc-non-fips-and-include-bc-fips",level:3}],u={toc:s},d="wrapper";function p(e){let{components:n,...a}=e;return(0,r.yg)(d,(0,t.A)({},u,a,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"bouncycastle-introduce"},"BouncyCastle Introduce"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"Bouncy Castle")," is a Java library that complements the default Java Cryptographic Extension (JCE),\nand it provides more cipher suites and algorithms than the default JCE provided by Sun."),(0,r.yg)("p",null,"In addition to that, ",(0,r.yg)("inlineCode",{parentName:"p"},"Bouncy Castle")," has lots of utilities for reading arcane formats like PEM and ASN.1 that no sane person would want to rewrite themselves."),(0,r.yg)("p",null,"In Pulsar, security and crypto have dependencies on BouncyCastle Jars. For the detailed installing and configuring Bouncy Castle FIPS, see ",(0,r.yg)("a",{parentName:"p",href:"https://www.bouncycastle.org/documentation.html"},"BC FIPS Documentation"),", especially the ",(0,r.yg)("strong",{parentName:"p"},"User Guides")," and ",(0,r.yg)("strong",{parentName:"p"},"Security Policy")," PDFs."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"Bouncy Castle")," provides both ",(0,r.yg)("a",{parentName:"p",href:"https://www.bouncycastle.org/fips_faq.html"},"FIPS")," and non-FIPS versions. But in a JVM, you can not include both of the 2 versions, and you need to exclude the current version before including the other."),(0,r.yg)("p",null,"In Pulsar, the security and crypto methods also depend on ",(0,r.yg)("inlineCode",{parentName:"p"},"Bouncy Castle"),", especially in ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/security-tls-authentication"},"mTLS authentication")," and ",(0,r.yg)("a",{parentName:"p",href:"/docs/4.0.x/security-encryption"},"Transport Encryption"),". This document contains the configuration between BouncyCastle FIPS(BC-FIPS) and non-FIPS(BC-non-FIPS) version while using Pulsar."),(0,r.yg)("h2",{id:"how-bouncycastle-modules-packaged-in-pulsar"},"How BouncyCastle modules packaged in Pulsar"),(0,r.yg)("p",null,"In Pulsar's ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle")," module, We provide 2 sub modules: ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc"),"(for non-FIPS versions) and ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bcfips"),"(for FIPS version), to package BC jars together to make the include and exclude of ",(0,r.yg)("inlineCode",{parentName:"p"},"Bouncy Castle")," easier."),(0,r.yg)("p",null,"To achieve this goal, we will need to package several ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle")," jars together into ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bcfips")," jar.\nEach of the original bouncy-castle jars is related to security, so BouncyCastle dutifully supplies signed of each jar.\nBut when we do the re-package, Maven shade explodes the BouncyCastle jar file which puts the signatures into META-INF,\nthese signatures aren't valid for this new, uber-jar (signatures are only for the original BC jar).\nUsually, You will meet error like ",(0,r.yg)("inlineCode",{parentName:"p"},"java.lang.SecurityException: Invalid signature file digest for Manifest main attributes"),"."),(0,r.yg)("p",null,"You can exclude these signatures in the mvn pom file to avoid the above error."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<exclude>META-INF/*.SF</exclude>\n<exclude>META-INF/*.DSA</exclude>\n<exclude>META-INF/*.RSA</exclude>\n")),(0,r.yg)("p",null,"But it can also lead to new, cryptic errors, e.g. ",(0,r.yg)("inlineCode",{parentName:"p"},"java.security.NoSuchAlgorithmException: PBEWithSHA256And256BitAES-CBC-BC SecretKeyFactory not available"),"\nBy explicitly specifying where to find the algorithm like this: ",(0,r.yg)("inlineCode",{parentName:"p"},'SecretKeyFactory.getInstance("PBEWithSHA256And256BitAES-CBC-BC","BC")'),"\nIt will get the real error: ",(0,r.yg)("inlineCode",{parentName:"p"},"java.security.NoSuchProviderException: JCE cannot authenticate the provider BC")),(0,r.yg)("p",null,"So, we used a ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/nthuemmel/executable-packer-maven-plugin"},"executable packer plugin")," that uses a jar-in-jar approach to preserve the BouncyCastle signature in a single, executable jar."),(0,r.yg)("h3",{id:"include-dependencies-of-bc-non-fips"},"Include dependencies of BC-non-FIPS"),(0,r.yg)("p",null,"Pulsar module ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc"),", which is defined by ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle/bc/pom.xml")," contains the needed non-FIPS jars for Pulsar, and packaged as a jar-in-jar(need to provide ",(0,r.yg)("inlineCode",{parentName:"p"},"<classifier>pkg</classifier>"),")."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>org.bouncycastle</groupId>\n  <artifactId>bcpkix-jdk15on</artifactId>\n  <version>${bouncycastle.version}</version>\n</dependency>\n\n<dependency>\n  <groupId>org.bouncycastle</groupId>\n  <artifactId>bcprov-ext-jdk15on</artifactId>\n  <version>${bouncycastle.version}</version>\n</dependency>\n")),(0,r.yg)("p",null,"By using this ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc")," module, you can easily include and exclude BouncyCastle non-FIPS jars."),(0,r.yg)("h3",{id:"modules-that-include-bc-non-fips-module-bouncy-castle-bc"},"Modules that include BC-non-FIPS module (",(0,r.yg)("inlineCode",{parentName:"h3"},"bouncy-castle-bc"),")"),(0,r.yg)("p",null,"For Pulsar client, user need the bouncy-castle module, so ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-original")," will include the ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc")," module, and have ",(0,r.yg)("inlineCode",{parentName:"p"},"<classifier>pkg</classifier>")," set to reference the ",(0,r.yg)("inlineCode",{parentName:"p"},"jar-in-jar")," package.\nIt is included as the following example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>bouncy-castle-bc</artifactId>\n  <version>${pulsar.version}</version>\n  <classifier>pkg</classifier>\n</dependency>\n")),(0,r.yg)("p",null,"By default ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc")," already included in ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-original"),", And ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-original")," has been included in a lot of other modules like ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-admin"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-broker"),".\nBut for the above shaded jar and signatures reason, we should not package Pulsar's ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle")," module into ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-all")," other shaded modules directly, such as ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-shaded"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client-admin-shaded")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-broker-shaded"),".\nSo in the shaded modules, we will exclude the ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle")," modules."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<filters>\n  <filter>\n    <artifact>org.apache.pulsar:pulsar-client-original</artifact>\n    <includes>\n      <include>**</include>\n    </includes>\n    <excludes>\n      <exclude>org/bouncycastle/**</exclude>\n    </excludes>\n  </filter>\n</filters>\n")),(0,r.yg)("p",null,"That means, ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle")," related jars are not shaded in these fat jars."),(0,r.yg)("h3",{id:"module-bc-fips-bouncy-castle-bcfips"},"Module BC-FIPS (",(0,r.yg)("inlineCode",{parentName:"h3"},"bouncy-castle-bcfips"),")"),(0,r.yg)("p",null,"Pulsar module ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bcfips"),", which is defined by ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle/bcfips/pom.xml"),", contains the needed FIPS jars for Pulsar.\nSimilar to ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bc"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"bouncy-castle-bcfips")," is also packaged as a ",(0,r.yg)("inlineCode",{parentName:"p"},"jar-in-jar")," package for easy include/exclude."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>org.bouncycastle</groupId>\n  <artifactId>bc-fips</artifactId>\n  <version>${bouncycastle.bc-fips.version}</version>\n</dependency>\n\n<dependency>\n  <groupId>org.bouncycastle</groupId>\n  <artifactId>bcpkix-fips</artifactId>\n  <version>${bouncycastle.bcpkix-fips.version}</version>\n</dependency>\n")),(0,r.yg)("h3",{id:"exclude-bc-non-fips-and-include-bc-fips"},"Exclude BC-non-FIPS and include BC-FIPS"),(0,r.yg)("p",null,"If you want to switch from BC-non-FIPS to BC-FIPS version, Here is an example for ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-broker")," module:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>pulsar-broker</artifactId>\n  <version>${pulsar.version}</version>\n  <exclusions>\n    <exclusion>\n      <groupId>org.apache.pulsar</groupId>\n      <artifactId>bouncy-castle-bc</artifactId>\n    </exclusion>\n  </exclusions>\n</dependency>\n\n<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>bouncy-castle-bcfips</artifactId>\n  <version>${pulsar.version}</version>\n  <classifier>pkg</classifier>\n</dependency>\n")),(0,r.yg)("p",null,"For more example, you can reference module ",(0,r.yg)("inlineCode",{parentName:"p"},"bcfips-include-test"),"."))}p.isMDXComponent=!0}}]);