"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[51283],{15680:(e,a,t)=>{t.d(a,{xA:()=>g,yg:()=>m});var n=t(96540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),u=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},g=function(e){var a=u(e.components);return n.createElement(i.Provider,{value:a},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),p=u(t),d=r,m=p["".concat(i,".").concat(d)]||p[d]||c[d]||o;return t?n.createElement(m,s(s({ref:a},g),{},{components:t})):n.createElement(m,s({ref:a},g))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=d;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l[p]="string"==typeof e?e:r,s[1]=l;for(var u=2;u<o;u++)s[u]=t[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},19365:(e,a,t)=>{t.d(a,{A:()=>s});var n=t(96540),r=t(20053);const o={tabItem:"tabItem_Ymn6"};function s(e){let{children:a,hidden:t,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,s),hidden:t},a)}},89089:(e,a,t)=>{t.d(a,{A:()=>T});var n=t(58168),r=t(96540),o=t(20053),s=t(23104),l=t(56347),i=t(57485),u=t(31682),g=t(89466);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:a,label:t,attributes:n,default:r}}=e;return{value:a,label:t,attributes:n,default:r}}))}function c(e){const{values:a,children:t}=e;return(0,r.useMemo)((()=>{const e=a??p(t);return function(e){const a=(0,u.X)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function d(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:t}=e;const n=(0,l.W6)(),o=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,i.aZ)(o),(0,r.useCallback)((e=>{if(!o)return;const a=new URLSearchParams(n.location.search);a.set(o,e),n.replace({...n.location,search:a.toString()})}),[o,n])]}function y(e){const{defaultValue:a,queryString:t=!1,groupId:n}=e,o=c(e),[s,l]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!d({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:o}))),[i,u]=m({queryString:t,groupId:n}),[p,y]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,o]=(0,g.Dv)(t);return[n,(0,r.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:n}),h=(()=>{const e=i??p;return d({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{h&&l(h)}),[h]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),y(e)}),[u,y,o]),tabValues:o}}var h=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:a,block:t,selectedValue:l,selectValue:i,tabValues:u}=e;const g=[],{blockElementScrollPositionUntilNextRender:p}=(0,s.a_)(),c=e=>{const a=e.currentTarget,t=g.indexOf(a),n=u[t].value;n!==l&&(p(a),i(n))},d=e=>{let a=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=g.indexOf(e.currentTarget)+1;a=g[t]??g[0];break}case"ArrowLeft":{const t=g.indexOf(e.currentTarget)-1;a=g[t]??g[g.length-1];break}}a?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},a)},u.map((e=>{let{value:a,label:t,attributes:s}=e;return r.createElement("li",(0,n.A)({role:"tab",tabIndex:l===a?0:-1,"aria-selected":l===a,key:a,ref:e=>g.push(e),onKeyDown:d,onClick:c},s,{className:(0,o.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":l===a})}),t??a)})))}function N(e){let{lazy:a,children:t,selectedValue:n}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=o.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==n}))))}function v(e){const a=y(e);return r.createElement("div",{className:(0,o.A)("tabs-container",f.tabList)},r.createElement(b,(0,n.A)({},e,a)),r.createElement(N,(0,n.A)({},e,a)))}function T(e){const a=(0,h.A)();return r.createElement(v,(0,n.A)({key:String(a)},e))}},5115:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>g,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>p});var n=t(58168),r=(t(96540),t(15680)),o=t(89089),s=t(19365);const l={id:"client-libraries-producers",title:"Work with producer",sidebar_label:"Work with producer",description:"Learn how to work with producers in Pulsar."},i=void 0,u={unversionedId:"client-libraries-producers",id:"version-3.3.x/client-libraries-producers",title:"Work with producer",description:"Learn how to work with producers in Pulsar.",source:"@site/versioned_docs/version-3.3.x/client-libraries-producers.md",sourceDirName:".",slug:"/client-libraries-producers",permalink:"/docs/3.3.x/client-libraries-producers",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.3.x/client-libraries-producers.md",tags:[],version:"3.3.x",frontMatter:{id:"client-libraries-producers",title:"Work with producer",sidebar_label:"Work with producer",description:"Learn how to work with producers in Pulsar."},sidebar:"docsSidebar",previous:{title:"Work with clients",permalink:"/docs/3.3.x/client-libraries-clients"},next:{title:"Work with consumer",permalink:"/docs/3.3.x/client-libraries-consumers"}},g={},p=[{value:"Create the producer",id:"create-the-producer",level:2},{value:"Publish messages",id:"publish-messages",level:2},{value:"Configure messages",id:"configure-messages",level:2},{value:"Publish messages to partitioned topics",id:"publish-messages-to-partitioned-topics",level:2},{value:"Use built-in message router",id:"use-built-in-message-router",level:3},{value:"Customize message router",id:"customize-message-router",level:3},{value:"Choose partitions when using a key",id:"choose-partitions-when-using-a-key",level:3},{value:"Enable chunking",id:"enable-chunking",level:2},{value:"Intercept messages",id:"intercept-messages",level:2},{value:"Configure encryption policies",id:"configure-encryption-policies",level:2},{value:"Configure access mode",id:"configure-access-mode",level:2}],c={toc:p},d="wrapper";function m(e){let{components:a,...t}=e;return(0,r.yg)(d,(0,n.A)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"After setting up your clients, you can explore more to start working with ",(0,r.yg)("a",{parentName:"p",href:"/docs/3.3.x/concepts-clients#producers"},"producers"),"."),(0,r.yg)("h2",{id:"create-the-producer"},"Create the producer"),(0,r.yg)("p",null,"This example shows how to create a producer."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("p",null,"  Create a producer synchronously:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'Producer<String> producer = pulsarClient.newProducer(Schema.STRING)\n              .topic("my-topic")\n              .create();\n')),(0,r.yg)("p",null,"  Create a producer asynchronously:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'pulsarClient.newProducer(Schema.STRING)\n              .topic("my-topic")\n              .createAsync()\n              .thenAccept(p -> {\n                  log.info("Producer created: {}", p.getProducerName());\n              });\n'))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'Producer producer;\nResult result = client.createProducer("my-topic", producer);\n')))),(0,r.yg)("h2",{id:"publish-messages"},"Publish messages"),(0,r.yg)("p",null,"Pulsar supports both synchronous and asynchronous publishing of messages in most clients. In some language-specific clients, such as Node.js and C#, you can publish messages synchronously based on the asynchronous method using language-specific mechanisms (like ",(0,r.yg)("inlineCode",{parentName:"p"},"await"),")."),(0,r.yg)("p",null,"With async publishment, the producer puts the message in a blocking queue and returns it immediately. Then the client library sends the message to the broker in the background. If the queue is full (max size configurable), the producer is blocked or fails immediately when calling the API, depending on arguments passed to the producer."),(0,r.yg)("p",null,"This example shows how to publish messages using producers. The publish operation is done until the broker tells you the message has been successfully published. The broker returns the message ID after the message is published successfully."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Go",value:"Go"},{label:"Node.js",value:"Node.js"},{label:"C#",value:"C#"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("p",null,"  Publish messages synchronously:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'MessageId messageId = producer.newMessage()\n                  .value("my-sync-message")\n                  .send();\n')),(0,r.yg)("p",null,"  Publish messages asynchronously:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'producer.newMessage()\n        .value("my-sync-message")\n        .sendAsync()\n        .thenAccept(messageId -> {\n            log.info("Message ID: {}", messageId);\n        });\n'))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'Message msg = MessageBuilder()\n                    .setContent("my-sync-message")\n                    .build();\nResult res = producer.send(msg);\n'))),(0,r.yg)(s.A,{value:"Go",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-go"},' msg := pulsar.ProducerMessage{\n     Payload: []byte("my-sync-message"),\n }\n\n if _, err := producer.send(msg); err != nil {\n   log.Fatalf("Could not publish message due to: %v", err)\n }\n')),(0,r.yg)("p",null,"  For all methods of the ",(0,r.yg)("inlineCode",{parentName:"p"},"ProducerMessage")," object, see ",(0,r.yg)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/apache/pulsar-client-go/pulsar#ProducerMessage"},"Go API doc"),".")),(0,r.yg)(s.A,{value:"Node.js",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"const msg = {\ndata: Buffer.from('my-sync-message'),\n}\n\nawait producer.send(msg);\n")),(0,r.yg)("p",null,"The following keys are available for producer message objects:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"data")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The actual data payload of the message.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"properties")),(0,r.yg)("td",{parentName:"tr",align:"left"},"A Object for any application-specific metadata attached to the message.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"eventTimestamp")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The timestamp associated with the message.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"sequenceId")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The sequence ID of the message.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"partitionKey")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The optional key associated with the message (particularly useful for things like topic compaction).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"replicationClusters")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The clusters to which this message is replicated. Pulsar brokers handle message replication automatically; you should only change this setting if you want to override the broker default.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"deliverAt")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The absolute timestamp at or after which the message is delivered.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"deliverAfter")),(0,r.yg)("td",{parentName:"tr",align:"left"},"The relative delay after which the message is delivered.")))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Message object operations")),(0,r.yg)("p",null,"In Pulsar Node.js client, you can receive (or read) message objects as consumers (or readers)."),(0,r.yg)("p",null,"The message object has the following methods available:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Method"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Description"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Return type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getTopicName()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of topic name."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"String"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getProperties()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of properties."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Array<Object>"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getData()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of message data."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Buffer"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getMessageId()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of ",(0,r.yg)("a",{parentName:"td",href:"#message-id-object-operations"},"message id object"),"."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Object"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getPublishTimestamp()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of publish timestamp."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Number"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getEventTimestamp()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of event timestamp."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Number"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getRedeliveryCount()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of redelivery count."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Number"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"getPartitionKey()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Getter method of partition key."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"String"))))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Message ID object operations")),(0,r.yg)("p",null,"In Pulsar Node.js client, you can get message id objects from message objects."),(0,r.yg)("p",null,"The message id object has the following methods available:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Method"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Description"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Return type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"serialize()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Serialize the message id into a Buffer for storing."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Buffer"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"toString()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Get message id as String."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"String"))))),(0,r.yg)("p",null,"The client has a static method of message id object. You can access it as ",(0,r.yg)("inlineCode",{parentName:"p"},"Pulsar.MessageId.someStaticMethod"),"."),(0,r.yg)("p",null,"The following static methods are available for the message id object:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Method"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Description"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Return type"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"earliest()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"MessageId representing the earliest, or oldest available message stored in the topic."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Object"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"latest()")),(0,r.yg)("td",{parentName:"tr",align:"left"},"MessageId representing the latest, or last published message in the topic."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Object"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"deserialize(Buffer)")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Deserialize a message id object from a Buffer."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"Object")))))),(0,r.yg)(s.A,{value:"C#",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp"},'var data = Encoding.UTF8.GetBytes("Hello World");\nawait producer.Send(data);\n')))),(0,r.yg)("h2",{id:"configure-messages"},"Configure messages"),(0,r.yg)("p",null,"You can set various properties of Pulsar's messages. The values of these properties are stored in the metadata of a message."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"C#",value:"C#"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'producer.newMessage()\n              .key("my-key") // Set the message key\n              .eventTime(System.currentTimeMillis()) // Set the event time\n              .sequenceId(1203) // Set the sequenceId for the deduplication purposes\n              .deliverAfter(1, TimeUnit.HOURS) // Delay message delivery for 1 hour\n              .property("my-key", "my-value") // Set the customized metadata\n              .property("my-other-key", "my-other-value")\n              .replicationClusters(\n                      Lists.newArrayList("r1", "r2")) // Set the geo-replication clusters for this message.\n              .value("content")\n              .send();\n')),(0,r.yg)("p",null,"  For the Java client, you can also use ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," to configure the message metadata. Here is an example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'Map<String, Object> conf = new HashMap<>();\nconf.put("key", "my-key");\nconf.put("eventTime", System.currentTimeMillis());\nproducer.newMessage()\n        .value("my-message")\n        .loadConf(conf)\n        .send();\n'))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'Message msg = MessageBuilder()\n                  .setContent("content")\n                  .setProperty("my-key", "my-value")\n                  .setProperty("my-other-key", "my-other-value")\n                  .setDeliverAfter(std::chrono::minutes(3)) // Delay message delivery for 3 minutes\n                  .build();\nResult res = producer.send(msg);\n'))),(0,r.yg)(s.A,{value:"Go",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-go"},'ID, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n     Payload:      []byte(fmt.Sprintf("content")),\n     DeliverAfter: 3 * time.Second, // Delay message delivery for 3 seconds\n })\n if err != nil {\n     log.Fatal(err)\n }\n'))),(0,r.yg)(s.A,{value:"C#",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp"},'var messageId = await producer.NewMessage()\n                            .Property("SomeKey", "SomeValue")\n                            .Send(data);\n')))),(0,r.yg)("h2",{id:"publish-messages-to-partitioned-topics"},"Publish messages to partitioned topics"),(0,r.yg)("p",null,"By default, Pulsar topics are served by a single broker, which limits the maximum throughput of a topic. ",(0,r.yg)("em",{parentName:"p"},"Partitioned topics")," can span multiple brokers and thus allow for higher throughput."),(0,r.yg)("p",null,"You can publish messages to partitioned topics using Pulsar client libraries. When publishing messages to partitioned topics, you must specify a routing mode. If you do not specify any routing mode when you create a new producer, the round-robin routing mode is used."),(0,r.yg)("h3",{id:"use-built-in-message-router"},"Use built-in message router"),(0,r.yg)("p",null,"The routing mode determines which partition (internal topic) each message should be published to."),(0,r.yg)("p",null,"The following is an example:"),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'Producer<byte[]> producer = pulsarClient.newProducer()\n   .topic("my-topic")\n   .messageRoutingMode(MessageRoutingMode.SinglePartition)\n   .create();\n'))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "lib/RoundRobinMessageRouter.h" // Make sure include this header file\n\nProducer producer;\nResult result = client.createProducer(\n   "my-topic",\n   ProducerConfiguration().setMessageRouter(std::make_shared<RoundRobinMessageRouter>(\n       ProducerConfiguration::BoostHash, true, 1000, 100000, boost::posix_time::seconds(1))),\n   producer);\n'))),(0,r.yg)(s.A,{value:"Go",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-go"},' producer, err := client.CreateProducer(pulsar.ProducerOptions{\n     Topic: "my-topic",\n     MessageRouter: func(msg *pulsar.ProducerMessage, tm pulsar.TopicMetadata) int {\n         fmt.Println("Topic has", tm.NumPartitions(), "partitions. Routing message ", msg, " to partition 2.")\n         // always push msg to partition 2\n         return 2\n     },\n })\n')))),(0,r.yg)("h3",{id:"customize-message-router"},"Customize message router"),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("p",null,"To use a custom message router, you need to provide an implementation of the ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/3.3.x/org/apache/pulsar/client/api/MessageRouter"},"MessageRouter")," interface, which has just one ",(0,r.yg)("inlineCode",{parentName:"p"},"choosePartition")," method:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"public interface MessageRouter extends Serializable {\n    int choosePartition(Message msg);\n}\n")),(0,r.yg)("p",null,"The following router routes every message to partition 10:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"public class AlwaysTenRouter implements MessageRouter {\n    public int choosePartition(Message msg) {\n        return 10;\n    }\n}\n")),(0,r.yg)("p",null,"With that implementation, you can send messages to partitioned topics as below."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'Producer<byte[]> producer = pulsarClient.newProducer()\n        .topic("my-topic")\n        .messageRouter(new AlwaysTenRouter())\n        .create();\nproducer.send("Partitioned topic message".getBytes());\n'))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("p",null,"To use a custom message router, you need to provide an implementation of the ",(0,r.yg)("inlineCode",{parentName:"p"},"MessageRoutingPolicy")," interface, which has one ",(0,r.yg)("inlineCode",{parentName:"p"},"getPartition")," method:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},"class MessageRouter : public MessageRoutingPolicy {\n   public:\n    MessageRouter() : {}\n\n    int getPartition(const Message& msg, const TopicMetadata& topicMetadata) {\n        // The implementation of getPartition\n    }\n\n};\n")),(0,r.yg)("p",null,"The following router routes every message to partition 10:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},"class MessageRouter : public MessageRoutingPolicy {\n   public:\n    MessageRouter() {}\n\n    int getPartition(const Message& msg, const TopicMetadata& topicMetadata) {\n        return 10;\n    }\n};\n")),(0,r.yg)("p",null,"With that implementation, you can send messages to partitioned topics as below."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'Producer producer;\nResult result = client.createProducer(\n    "my-topic",\n    ProducerConfiguration().setMessageRouter(std::make_shared<MessageRouter>()),\n    producer);\nMessage msg = MessageBuilder().setContent("content").build();\nresult = producer.send(msg);\n'))),(0,r.yg)(s.A,{value:"Go",mdxType:"TabItem"},(0,r.yg)("p",null,"  In the Go client, you can configure a customized message router by passing a function."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-go"},' producer, err := client.CreateProducer(pulsar.ProducerOptions{\n     Topic: "my-topic",\n     MessageRouter: func(msg *pulsar.ProducerMessage, tm pulsar.TopicMetadata) int {\n         fmt.Println("Topic has", tm.NumPartitions(), "partitions. Routing message ", msg, " to partition 10.")\n         // always push msg to partition 10\n         return 10\n     },\n })\n')))),(0,r.yg)("h3",{id:"choose-partitions-when-using-a-key"},"Choose partitions when using a key"),(0,r.yg)("p",null,"If a message has a key, it supersedes the round robin routing policy. The following java example code illustrates how to choose the partition when using a key."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"// If the message has a key, it supersedes the round robin routing policy\nif (msg.hasKey()) {\n    return signSafeMod(hash.makeHash(msg.getKey()), topicMetadata.numPartitions());\n}\n\nif (isBatchingEnabled) { // if batching is enabled, choose partition on `partitionSwitchMs` boundary.\n    long currentMs = clock.millis();\n    return signSafeMod(currentMs / partitionSwitchMs + startPtnIdx, topicMetadata.numPartitions());\n} else {\n    return signSafeMod(PARTITION_INDEX_UPDATER.getAndIncrement(this), topicMetadata.numPartitions());\n}\n")),(0,r.yg)("h2",{id:"enable-chunking"},"Enable chunking"),(0,r.yg)("p",null,"Message ",(0,r.yg)("a",{parentName:"p",href:"/docs/3.3.x/concepts-messaging#chunking"},"chunking")," enables Pulsar to process large payload messages by splitting the message into chunks at the producer side and aggregating chunked messages on the consumer side."),(0,r.yg)("p",null,"The message chunking feature is OFF by default. The following is an example of how to enable message chunking when creating a producer."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Go",value:"Go"},{label:"Python",value:"Python"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"  Producer<byte[]> producer = client.newProducer()\n     .topic(topic)\n     .enableChunking(true)\n     .enableBatching(false)\n     .create();\n"))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'ProducerConfiguration conf;\nconf.setBatchingEnabled(false);\nconf.setChunkingEnabled(true);\nProducer producer;\nclient.createProducer("my-topic", conf, producer);\n'))),(0,r.yg)(s.A,{value:"Go",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-go"},'// The message chunking feature is OFF by default.\n// By default, a producer chunks the large message based on the max message size (`maxMessageSize`) configured at the broker side (for example, 5MB).\n// Client can also configure the max chunked size using the producer configuration `ChunkMaxMessageSize`.\n// Note: to enable chunking, you need to disable batching (`DisableBatching=true`) concurrently.\nproducer, err := client.CreateProducer(pulsar.ProducerOptions{\n  Topic:               "my-topic",\n  DisableBatching:     true,\n  EnableChunking:      true,\n})\n\nif err != nil {\n    log.Fatal(err)\n}\ndefer producer.Close()\n'))),(0,r.yg)(s.A,{value:"Python",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-python"},"producer = client.create_producer(\n         topic,\n         chunking_enabled=True\n     )\n")))),(0,r.yg)("p",null,"By default, producer chunks the large message based on max message size (",(0,r.yg)("inlineCode",{parentName:"p"},"maxMessageSize"),") configured at broker (eg: 5MB). However, client can also configure max chunked size using producer configuration ",(0,r.yg)("inlineCode",{parentName:"p"},"chunkMaxMessageSize"),"."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"To enable chunking, you need to disable batching (",(0,r.yg)("inlineCode",{parentName:"p"},"enableBatching"),"=",(0,r.yg)("inlineCode",{parentName:"p"},"false"),") concurrently.")),(0,r.yg)("h2",{id:"intercept-messages"},"Intercept messages"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"ProducerInterceptor")," intercepts and possibly mutates messages received by the producer before they are published to the brokers."),(0,r.yg)("p",null,"The interface has three main events:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"eligible")," checks if the interceptor can be applied to the message."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"beforeSend")," is triggered before the producer sends the message to the broker. You can modify messages within this event."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onSendAcknowledgement")," is triggered when the message is acknowledged by the broker or the sending failed.")),(0,r.yg)("p",null,"To intercept messages, you can add a ",(0,r.yg)("inlineCode",{parentName:"p"},"ProducerInterceptor")," or multiple ones when creating a ",(0,r.yg)("inlineCode",{parentName:"p"},"Producer")," as follows."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"Producer<byte[]> producer = client.newProducer()\n     .topic(topic)\n     .intercept(new ProducerInterceptor {\n            @Override\n            boolean eligible(Message message) {\n                return true;  // process all messages\n            }\n\n            @Override\n            Message beforeSend(Producer producer, Message message) {\n                // user-defined processing logic\n            }\n\n            @Override\n            void onSendAcknowledgement(Producer producer, Message message, MessageId msgId, Throwable exception) {\n                // user-defined processing logic\n            }\n     })\n     .create();\n"))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},"Implement the custom interceptor:",(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"}," class MyInterceptor : public ProducerInterceptor {\n   public:\n     MyInterceptor() {}\n\n     Message beforeSend(const Producer& producer, const Message& message) override {\n       // Your implementation code\n       return message;\n     }\n\n     void onSendAcknowledgement(const Producer& producer, Result result, const Message& message,\n                               const MessageId& messageID) override {\n       // Your implementation code\n     }\n\n     void close() override {\n       // Your implementation code\n     }\n };\n")),(0,r.yg)("p",null,"   Configue the producer:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"}," ProducerConfiguration conf;\n conf.intercept({std::make_shared<MyInterceptor>(),\n                 std::make_shared<MyInterceptor>()}); // You can add multiple interceptors to the same producer\n Producer producer;\n client.createProducer(topic, conf, producer);\n")))),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Multiple interceptors apply in the order they are passed to the ",(0,r.yg)("inlineCode",{parentName:"p"},"intercept")," method.")),(0,r.yg)("h2",{id:"configure-encryption-policies"},"Configure encryption policies"),(0,r.yg)("p",null,"The Pulsar C# client supports four kinds of encryption policies:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"EnforceUnencrypted"),": always use unencrypted connections."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"EnforceEncrypted"),": always use encrypted connections)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"PreferUnencrypted"),": use unencrypted connections, if possible."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"PreferEncrypted"),": use encrypted connections, if possible.")),(0,r.yg)("p",null,"This example shows how to set the ",(0,r.yg)("inlineCode",{parentName:"p"},"EnforceUnencrypted")," encryption policy."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"C#",values:[{label:"C#",value:"C#"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"C#",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp"},"using DotPulsar;\n\nvar client = PulsarClient.Builder()\n                      .ConnectionSecurity(EncryptionPolicy.EnforceEncrypted)\n                      .Build();\n")))),(0,r.yg)("h2",{id:"configure-access-mode"},"Configure access mode"),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"/docs/3.3.x/concepts-clients#access-mode"},"Access mode"),' allows applications to require exclusive producer access on a topic to achieve a "single-writer" situation.'),(0,r.yg)("p",null,"This example shows how to set producer access mode."),(0,r.yg)(o.A,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"}],mdxType:"Tabs"},(0,r.yg)(s.A,{value:"Java",mdxType:"TabItem"},(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"This feature is supported in Java client 2.8.0 or later versions.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"Producer<byte[]> producer = client.newProducer()\n     .topic(topic)\n     .accessMode(ProducerAccessMode.Exclusive)\n     .create();\n"))),(0,r.yg)(s.A,{value:"C++",mdxType:"TabItem"},(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"This feature is supported in C++ client 3.1.0 or later versions.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"}," Producer producer;\n ProducerConfiguration producerConfiguration;\n producerConfiguration.setAccessMode(ProducerConfiguration::Exclusive);\n client.createProducer(topicName, producerConfiguration, producer);\n")))))}m.isMDXComponent=!0}}]);